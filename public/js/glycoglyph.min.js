//  v2.1.0 Copyright 2020 Akul Mehta
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).glycoglyph={})}(this,(function(e){"use strict";var t={nameInputID:"cfg_name",glycoCTID:"glycoCT",preparedSubstituentSpan:"subscheck",preparedMonosaccharideSpan:"monocheck",preparedLinkageSpan:"linkagecheck",undodiv:"undodiv",redodiv:"redodiv",multimode:"multimode",glytoucanTableDiv:"gtcid",commonMonoList:"commonmonolist",fullMonoList:"fullmonolist",parametersdiv:"calculated_parametersdiv"},n={monosSVG:`${window.location.protocol}//${window.location.host}/assets/images/monos.svg`,css:`${window.location.protocol}//${window.location.host}/css/glycoglyph.css`,images:`${window.location.protocol}//${window.location.host}/assets/images/`},a={child:{name:"",linkage:"",monosaccharide:"",linknum:0,substituent:"",children:[]}};let i={width:320,height:465,editingMode:!0,orientation:"bottom-to-top",drawdivID:"d3glycanstruc",symbsize:25,drawingareachoice:"fixglycansize",fucopt:"fucdown",linkageVisible:!0,linkRotate:!0,linkAbbr:!1,linkFontSize:12,margin:{top:40,right:40,bottom:40,left:40},drawingSettingsDivID:"glycoglyphDrawingSettings",userOverrideOptions:!0};var r={multimode:!1},o=["Glc","Man","Gal","Gul","Alt","All","Tal","Ido","GlcNAc","ManNAc","GalNAc","GulNAc","AltNAc","AllNAc","TalNAc","IdoNAc","GlcN","ManN","GalN","GulN","AltN","AllN","TalN","IdoN","GlcA","ManA","GalA","GulA","AltA","AllA","TalA","IdoA","Qui","Rha","6dGul","6dAlt","6dTal","Fuc","QuiNAc","RhaNAc","6dAltNAc","6dTalNAc","FucNAc","Oli","Tyv","Abe","Par","Dig","Col","Ara","Lyx","Xyl","Rib","Kdn","Neu5Ac","Neu5Gc","Neu","Sia","Pse","Leg","Aci","4eLeg","Bac","LDmanHep","Kdo","Dha","DDmanHep","MurNAc","MurNGc","Mur","Api","Fru","Tag","Sor","Psi","Hex","HexN","HexNAc","HexA"],c=["Glc","Man","Gal","GlcNAc","GalNAc","Fuc","Neu5Ac","Neu5Gc","Neu","Xyl","IdoA","GlcA","Unknown"],l=[{name:"Chitobiose-core",structure:"GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core",structure:"Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-fuc",structure:"Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-bis",structure:"Mana1-6(GlcNAcb1-4)(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-bis-fuc",structure:"Mana1-6(GlcNAcb1-4)(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-hyb",structure:"Mana1-6(Mana1-3)Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-hyb-fuc",structure:"Mana1-6(Mana1-3)Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-oligoman",structure:"Mana1-2Mana1-6(Mana1-2Mana1-3)Mana1-6(Mana1-2Mana1-2Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"Core-1",structure:"Galb1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-2",structure:"GlcNAcb1-6(Galb1-3)GalNAca1",type:"starter",subtype:"O"},{name:"Core-3",structure:"GlcNAcb1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-4",structure:"GlcNAcb1-6(GlcNAcb1-3)GalNAca1",type:"starter",subtype:"O"},{name:"Core-5",structure:"GalNAca1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-6",structure:"GlcNAcb1-6GalNAca1",type:"starter",subtype:"O"},{name:"Core-7",structure:"GalNAca1-6GalNAca1",type:"starter",subtype:"O"},{name:"Core-8",structure:"Gala1-3GalNAca1",type:"starter",subtype:"O"}],d=[{name:"Blood Group A",sequence:"GalNAca1-3(Fuca1-2)Gal",type:"antigen"},{name:"Blood Group B",sequence:"Galb1-3(Fuca1-2)Gal",type:"antigen"},{name:"Blood Group H",sequence:"Fuca1-2Gal",type:"antigen"},{name:"CAD Antigen",sequence:"Neu5Aca2-6(GalNAcb1-4(Neu5Aca2-3)Galb1-3)GalNAc",type:"antigen"},{name:"Forsmann Antigen",sequence:"GalNAca1-3GalNAcb1-3Gal",type:"antigen"},{name:"Galili Antigen",sequence:"Gala1-3Galb1-4GlcNAc",type:"antigen"},{name:"P antigen",sequence:"GalNAcb1-3Gala1-4Galb1-4Glc",type:"antigen"},{name:"Pk antigen",sequence:"Gala1-4Galb1-4Glc",type:"antigen"},{name:"SDA Antigen",sequence:"GalNAcb1-4(Neu5Aca2-3)Galb1-4GlcNAcb1-3Gal",type:"antigen"},{name:"High Mannose Terminals",sequence:"Mana1-2Man",type:"mannose"},{name:"LacDiNAc",sequence:"GalNAcb1-4GlcNAc",type:"lactosamine"},{name:"Lactosamine",sequence:"Galb1-4GlcNAc",type:"lactosamine"},{name:"Neo-Lactosamine",sequence:"Galb1-3GlcNAc",type:"lactosamine"},{name:"Poly-Lactosamine",sequence:"Galb1-4GlcNAcb1-3Galb1-4GlcNAc",type:"lactosamine"},{name:"Lewis A",sequence:"Galb1-3(Fuca1-4)GlcNAc",type:"lewis"},{name:"Lewis B",sequence:"Fuca1-2Galb1-3(Fuca1-4)GlcNAc",type:"lewis"},{name:"Lewis C",sequence:"Galb1-3GlcNAc",type:"lewis"},{name:"Lewis D",sequence:"Fuca1-2Galb1-3GlcNAc",type:"lewis"},{name:"Lewis X",sequence:"Galb1-4(Fuca1-3)GlcNAc",type:"lewis"},{name:"Lewis Y",sequence:"Fuca1-2Galb1-4(Fuca1-3)GlcNAc",type:"lewis"}],s={Hex:{glycoct:"HEX",transform:"",configdefault:""},Glc:{glycoct:"glc-HEX",transform:"",configdefault:"d"},Man:{glycoct:"man-HEX",transform:"",configdefault:"d"},Gal:{glycoct:"gal-HEX",transform:"",configdefault:"d"},Gul:{glycoct:"gul-HEX",transform:"",configdefault:"d"},Alt:{glycoct:"alt-HEX",transform:"",configdefault:"l"},All:{glycoct:"all-HEX",transform:"",configdefault:"d"},Tal:{glycoct:"tal-HEX",transform:"",configdefault:"d"},Ara:{glycoct:"ara-PEN",transform:"",configdefault:"l"},Lyx:{glycoct:"lyx-PEN",transform:"",configdefault:"d"},Rib:{glycoct:"rib-PEN",transform:"",configdefault:"d"},Bac:{glycoct:"glc-HEX",transform:"|2:d|4:d|6:d",configdefault:"d"},Fuc:{glycoct:"gal-HEX",transform:"-1:5|6:d",configdefault:"l"},HexA:{glycoct:"HEX",transform:"|6:a",configdefault:""},GlcA:{glycoct:"glc-HEX",transform:"-1:5|6:a",configdefault:"d"},ManA:{glycoct:"man-HEX",transform:"-1:5|6:a",configdefault:"d"},GalA:{glycoct:"gal-HEX",transform:"-1:5|6:a",configdefault:"d"},GulA:{glycoct:"gul-HEX",transform:"-1:5|6:a",configdefault:"d"},AltA:{glycoct:"alt-HEX",transform:"-1:5|6:a",configdefault:"l"},AllA:{glycoct:"all-HEX",transform:"-1:5|6:a",configdefault:"d"},TalA:{glycoct:"tal-HEX",transform:"-1:5|6:a",configdefault:"d"},Qui:{glycoct:"glc-HEX",transform:"-1:5|6:d",configdefault:"d"},dHex:{glycoct:"HEX",transform:"|6:d",configdefault:""},Ido:{glycoct:"ido-HEX",transform:"",configdefault:"l"},IdoA:{glycoct:"ido-HEX",transform:"-1:5|6:a",configdefault:"l"},Pen:{glycoct:"PEN-1:4",transform:"",configdefault:""},Rha:{glycoct:"man-HEX",transform:"|6:d",configdefault:"l"},SixdAlt:{glycoct:"alt-HEX",transform:"|6:d",configdefault:"l"},SixdTal:{glycoct:"tal-HEX",transform:"|6:d",configdefault:"d"},Xyl:{glycoct:"xyl-PEN",transform:"",configdefault:"d"},ddHex:{glycoct:"HEX",transform:"|2:d|6:d",configdefault:""},Unknown:{glycoct:"unknown",transform:"",configdefault:""},Oli:{glycoct:"PEN",transform:"|3:d|6:d",configdefault:""},Tyv:{glycoct:"ara-HEX",transform:"|3:d|6:d",configdefault:""},Abe:{glycoct:"dxyl-HEX",transform:"|3:d|6:d",configdefault:""},Par:{glycoct:"rib-HEX",transform:"|3:d|6:d",configdefault:""},Col:{glycoct:"lxyl-HEX",transform:"|3:d|6:d",configdefault:""},Dig:{glycoct:"rib-HEX",transform:"|2:d|6:d",configdefault:"d"},Nonu:{glycoct:"NON",transform:"",configdefault:""},Kdn:{glycoct:"gro-dgal-NON-2:6",transform:"|1:a|2:keto|3:d",configdefault:"d"},Kdo:{glycoct:"man-OCT-2:6",transform:"|1:a|2:keto|3:d",configdefault:"d"},Fru:{glycoct:"ara-HEX-2:5",transform:"|2:keto",configdefault:"d"},Assigned:{glycoct:"assigned-PEN",transform:"",configdefault:""},LDManHep:{glycoct:"ldmanhep-HEX",transform:"",configdefault:""},DDManHep:{glycoct:"ddmanhep-HEX",transform:"",configdefault:""},Dha:{glycoct:"dha-HEX",transform:"",configdefault:""},Mur:{glycoct:"mur-HEX",transform:"",configdefault:""},Sia:{glycoct:"sia-NON",transform:"",configdefault:""},Api:{glycoct:"api-PEN",transform:"",configdefault:"l"},Tag:{glycoct:"tag-PEN",transform:"",configdefault:"d"},Sor:{glycoct:"sor-PEN",transform:"",configdefault:"l"},Psi:{glycoct:"psi-PEN",transform:"",configdefault:"d"}};function u(e,t){return t&&"absolute"!==t?"relative"===t?e:void 0:`${window.location.protocol}//${window.location.host}${e}`}function g(e){(e=(e=(e=e.replace(/ /g,"")).replace(/\((?=\d[a-zA-Z]\))/g,"[")).replace(/(\[\d[a-zA-Z])\)/g,"$1]")).indexOf("GlcN(Gc)")>-1&&(e=e.replace(/GlcN\(Gc\)/,"GlcNGc"));var t=function(e){var t=e.split(/(\)|\(|-[\d,\?]|-(?=[a-zA-z]))/g).filter((function(e){return""!==e})),n=[];for(let e=0;e<t.length-1;e++)t[e+1].search(/\-[\d,\?]/)>-1?n.push(t[e]+t[e+1]):t[e].search(/\-/)<0&&n.push(t[e]);return n.push(t[t.length-1]),n}(e);function n(e,t,n,a){let i=e.lastIndexOf("(");if("("===t)e.push(t);else if(")"===t)e.splice(i,1);else if("-"!==t){var r,c,l,d,s=t.substring(t.lastIndexOf("]")+1,t.length);s!=t&&(l=t.replace(s,""));for(let e=0;e<s.length;e++)if(!0===o.includes(s.substring(0,s.length-e))){d=+(r=s.substring(s.length-e,s.length)).substr(-1),c=s.substring(0,s.length-e);break}t.search(/Neu5\,9Ac2?/g)>-1&&(c="Neu5Ac",l="[9Ac]",d=+(r=t.replace(/Neu5\,9Ac2?/g,"")).substr(-1)),null==r&&(r=""),null==c&&(c=""),null==l&&(l=""),null==d&&(d=0);var u=r.charAt(0);/^\d+$/.test(u)&&(u="?"),/\-$/.test(r)&&(r=r.replace(/\-$/,"")),e.push({name:t,linkage:r,monosaccharide:c,substituent:l,linknum:d,anomer:u,uniqueNodeID:n,children:e.splice(i+1,e.length-i-1).reverse()})}return e}return JSON.stringify(t.reduce(n,[])[0],0,2)}function p(e,t=!1){return e.children&&e.data.children.length>0&&(t?e.children.sort((function(e,t){return d3.descending(e.data.linknum,t.data.linknum)})):e.children.sort((function(e,t){return d3.ascending(e.data.linknum,t.data.linknum)})),e.children.findIndex(e=>"Fuc"==e.data.monosaccharide)>-1&&e.depth<=1&&"GlcNAc"===e.data.monosaccharide&&e.children.findIndex(e=>"GlcNAc"==e.data.monosaccharide)>-1&&e.children.sort((e,t)=>"Fuc"==e.data.monosaccharide?-1:"Fuc"==t.data.monosaccharide?1:0),e.children.forEach(e=>{p(e,t)})),e}function m(){a.child={name:"",linkage:"",monosaccharide:"",linknum:0,substituent:"",children:[]},$("#"+t.preparedSubstituentSpan).empty(),$("#"+t.preparedMonosaccharideSpan).empty(),$("#"+t.preparedLinkageSpan).empty()}function f(e){if("Unknown"===e){var n=prompt("Please enter name for the node","");if(null==n)return void alert("Error: Name for the node was blank - did not add the node");e=n}a.child.monosaccharide=e,a.child.children=[],$("#"+t.preparedMonosaccharideSpan).empty().append(e),h()}function h(){a.child.name=a.child.substituent+a.child.monosaccharide+a.child.linkage}function y(e,t){var n="";return""!=e.data.monosaccharide&&""!=e.data.linkage?(void 0!==e.data.substituent&&"[]"!==e.data.substituent||(e.data.substituent=""),e.data.linkage&&-1===e.data.linkage.search("-")&&e.depth>0&&(e.data.linkage=e.data.linkage+"-"),n=e.data.substituent+e.data.monosaccharide+e.data.linkage+n):n=""==e.data.linkage&&null==e.parent?e.data.name+n:e.data.name+"-"+n,t>1&&(n+=")"),e.data.children&&e.data.children.length>0&&e.children.forEach((t,a)=>{n=y(t,e.children.length-a)+n}),t>1&&(n="("+n),n}function b(){var e=document.getElementById(t.nameInputID).value;if(""!==e){var n=A(g(e)).replace(/\n/g,"<br>");document.getElementById(t.glycoCTID).innerHTML=n}else alert("No name typed. Please check Name above.")}function A(e){var t=JSON.parse(e);t=d3.hierarchy(t);var n="RES\n",a=1,i="LIN\n",r=1;return function e(t,o=1){var c=t.data,l=c.monosaccharide,d=a,u=function(e){if(""===t)return[];var t=[];"object"==typeof(t=(t=e.replace(/\[(?=[0-9a-zA-Z])/g,"").replace(/\](?=[0-9a-zA-Z])/g,",").replace("]","")).split(/,/g))&&(t=[t]);return t}(c.substituent).pop(),g="";g=null==c.anomer?"x":""===c.anomer||"-"===c.anomer?"o":"?"==c.anomer?"x":c.anomer;var p="";l.indexOf("NAc")>-1?(p=l.split("NAc")[0],u.unshift("NAc")):l.indexOf("NGc")>-1?(p=l.split("NGc")[0],u.unshift("NGc")):"Neu5Ac"===l?(p="Kdn",u.unshift("5Ac")):"Neu5Gc"===l?(p="Kdn",u.unshift("5Gc")):l.indexOf("N")>-1&&s.hasOwnProperty(l.replace(/N/g,""))?(p=l.replace(/N/g,""),u.unshift("N")):p=l;var m=function(e,t){if("o"===t)return"0:0";var n="Gal,Glc,Man,GalNAc,GlcNAc,ManNAc,Fuc,Neu5Ac,Neu5Gc,Neu,Sia,Xyl,IdoA,GlcA,\n  GalA,GlcA,ManA,GlcN,GalN,ManN,Hex,HexNAc,HexA,HexN\n  ",a="Rib,Api,Ara";if(n=n.split(/,/g),a=a.split(/,/g),n.includes(e))return"1:5";if(a.includes(e))return"1:4";return"x:x"}(l,g);if(s.hasOwnProperty(p)&&(""==s[p].transform?(n+=a+"b:"+g+"-"+s[p].configdefault+s[p].glycoct+"-"+m+s[p].transform,"o"===g&&(n+="|1:aldi")):n+=a+"b:"+g+"-"+s[p].configdefault+s[p].glycoct+s[p].transform,n+="\n",a++),""!==c.linkage&&"?"!==c.linkage&&1!=r){var f=c.linkage,h=f.charAt(f.length-1),y=f.charAt(f.indexOf("-")-1);"?"===h&&(h="-1"),"?"===y&&(y="1"),i+=`${r}:${o}o(${h}+${y})${d}d\n`,r++}return(u=u.filter(e=>""!==e)).forEach(e=>{var t,o;switch(!0){case"NAc"===e:t=2,o="n-acetyl";break;case"NGc"===e:t=2,o="n-glycolyl";break;case e.indexOf("Ac")>-1:t=e.split(/(?!\d)/g)[0],o="acetyl","Neu5Ac"===l&&5==t&&(o="n-acetyl");break;case e.indexOf("Gc")>-1:t=e.split(/(?!\d)/g)[0],o="glycolyl","Neu5Gc"===l&&(o="n-glycolyl");break;case e.indexOf("Me")>-1:t=e.split(/(?!\d)/g)[0],o="methyl";break;case e.indexOf("N")>-1:t=2,o="amino";break;case e.indexOf("S")>-1:t=e.split(/(?!\d)/g)[0],o="sulfate";break;case e.indexOf("P")>-1:t=e.split(/(?!\d)/g)[0],o="phospho";break;default:t=e.charAt(0),o=e.split(/(?!\d)/g)[1]}n+=`${a}s:${o}\n`,i+=`${r}:${d}d(${t}+1)${a}n\n`,r++,a++}),t.data.children.length>0&&t.children.forEach(t=>e(t,d)),t}(t),("LIN\n"!==i?n+i:n).trim()}function v(n){e.tracknum>-1&&$("#"+t.undodiv).removeClass("hide").addClass("show"),e.trackname[e.tracknum]!=n&&(e.tracknum++,e.trackname[e.tracknum]=n,e.trackname=e.trackname.filter((t,n)=>n<=e.tracknum),e.tracknum<e.trackname.length&&$("#"+t.redodiv).addClass("hide").removeClass("show"))}function N(e){var n=y(p(d3.hierarchy(e)));v(n),document.getElementById(t.nameInputID).value=n,w(n),b()}function x(e,n){if(""==a.child.monosaccharide)return alert("No monosaccharide selected. \n\nPlease select a monosaccharide to add."),m(),void $("#"+t.multimode).empty();""===a.child.linkage&&(a.child.linkage="??-?");var i=document.getElementById(t.nameInputID).value,r=JSON.parse(g(i)),o=0,c=!1;!function t(n){if(n.name===e[o].data.name)if(o<e.length-1){o++;var i=n.children.findIndex(t=>t.name===e[o].data.name&&t.uniqueNodeID===e[o].data.uniqueNodeID);t(n.children[i])}else n.children.forEach(e=>{e.linknum==a.child.linknum&&(c=!0,alert("You are trying to add a node to a position which is occupied. \nTwo nodes cannot have same linkage acceptor position. \nPlease check the linkages."))}),!1===c&&n.children.push(a.child);return n}(r),N(r),!1===c&&0==n&&m()}function G(e,n){if(1==e.length)return N(a.child),void m();if(""!=a.child.monosaccharide||""!=a.child.linkage||""!=a.child.substituent){var i=document.getElementById(t.nameInputID).value,r=JSON.parse(g(i)),o=0;!function t(n){if(n.name===e[o].data.name)if(o<e.length-2){o++;var i=n.children.findIndex(t=>t.name===e[o].data.name&&t.uniqueNodeID===e[o].data.uniqueNodeID);t(n.children[i])}else{i=n.children.findIndex(t=>t.name===e[o+1].data.name);if(""!=a.child.linkage){var r=n.children.findIndex(e=>e.linknum===a.child.linknum);if(r>-1&&r!=i)return void alert("Two nodes cannot have same linkage position. Please check linkages.");n.children[i].linkage=a.child.linkage,n.children[i].linknum=a.child.linknum}""!=a.child.monosaccharide&&(n.children[i].monosaccharide=a.child.monosaccharide),""!=a.child.substituent?n.children[i].substituent=a.child.substituent:"[]"==a.child.substituent&&(n.children[i].substituent=""),n.children[i].name=n.children[i].substituent+n.children[i].monosaccharide+n.children[i].linkage}return n}(r),N(r),!1===n&&m()}else alert("No replacement criteria selected. Please select what would you like to replace with.")}function k(e){if(1==e.length)return document.getElementById(t.nameInputID).value="",$("#d3glycanstruc").empty(),void $("#glycoCT").html("");var n=document.getElementById(t.nameInputID).value,a=JSON.parse(g(n)),i=0;!function t(n){if(n.name===e[i].data.name)if(i<e.length-2){i++;var a=n.children.findIndex(t=>t.name===e[i].data.name&&t.uniqueNodeID===e[i].data.uniqueNodeID);t(n.children[a])}else{a=n.children.findIndex(t=>t.name===e[i+1].data.name&&t.uniqueNodeID===e[i+1].data.uniqueNodeID);n.children.splice(a,1)}return n}(a),N(a),m()}function w(e,t){let a=JSON.parse(JSON.stringify(i));if(void 0!==t)for(var o in t)void 0!==t[o]&&(a[o]=t[o]);if(!0===a.userOverrideOptions&&(a=function(e){let t=document.querySelector(`#${e.drawingSettingsDivID} form`);if(!t)return console.warn("GlycoGlyph: No settings div found, using default options."),e;return t.querySelectorAll("input, select, checkbox").forEach(t=>{"checkbox"===t.type?e[t.id]=t.checked:"number"===t.type?e[t.id]=+t.value:e[t.id]=t.value}),e}(a)),"right-to-left"===a.orientation){let e=a.width;a.width=a.height,a.height=e}var c=g(e),l=JSON.parse(c),d=function e(t){var n=0;t.children&&t.children.forEach((function(t){var a=e(t);a>n&&(n=a)}));return 1+n}(l),s=a.margin;let u,m;"right-to-left"==a.orientation?u=a.height-s.top-s.bottom:m=a.width-s.left-s.right,"fixdrawingarea"===a.drawingareachoice?"right-to-left"==a.orientation?m=a.width-s.left-s.right:u=a.height-s.top-s.bottom:"fixglycansize"===a.drawingareachoice&&d<=2||"fixglycansize"===a.drawingareachoice&&d<9?"right-to-left"==a.orientation?m=50*d:u=50*d:"fixglycansize"===a.drawingareachoice&&d>=9&&("right-to-left"==a.orientation?m=a.width-s.top-s.bottom:u=a.height-s.top-s.bottom);var f={"right-to-left":{size:[u,m],x:function(e){return m-e.y},y:function(e){return e.x}},"bottom-to-top":{size:[m,u],x:function(e){return e.x},y:function(e){return u-e.y}}};d3.select(`#${a.drawdivID}sub`).remove(),"bottom-to-top"===a.orientation?d3.select("#"+a.drawdivID).style("flex-direction","column-reverse"):d3.select("#"+a.drawdivID).style("flex-direction","row-reverse");d3.select("#"+a.drawdivID).append("div").attr("id",a.drawdivID+"sub");var h,y=d3.select(`#${a.drawdivID}sub`).append("svg").attr("id",a.drawdivID+"SVG").attr("width",m+s.left+s.right).attr("height",u+s.top+s.bottom).append("g").attr("id","glycang").attr("transform","translate("+s.left+","+s.top+")"),b=f[a.orientation],A=d3.tree().size(b.size),v=d3.hierarchy(l);("right-to-left"==a.orientation&&(v=p(v,!0)),function(e,t){if("fucoriginal"===t.fucopt)return;let n=t.width-t.margin.left-t.margin.right;"right-to-left"===t.orientation&&(n=t.height-t.margin.top-t.margin.bottom);var a=e.x;e.each(e=>{if("Fuc"===e.data.monosaccharide){if(0===e.depth)return;e.parent.children[0].x,e.parent.children[e.parent.children.length-1].x,e.parent.children.filter(e=>-1===e.data.name.search("Fuc")).length,e.parent.children.length;e.y=e.parent.y;var i,r=e.parent.x;"fucout"===t.fucopt&&(e.x<a?e.x=e.parent.x-n/5:e.x>a?e.x=e.parent.x+n/5:e.x==a?e.parent.x<a?e.x=e.parent.x-n/5:e.parent.x>a?e.x=e.parent.x+n/5:e.x=e.parent.x-n/5:e.x=e.parent.x-n/5),"fucdown"===t.fucopt&&(e.x<e.parent.x?e.x=e.parent.x-n/5:e.x=e.parent.x+n/5),"fucleft"===t.fucopt&&(e.x=e.parent.x-n/5),e.parent.children.forEach(e=>{"Fuc"!==e.data.monosaccharide&&null==i&&(i=e.x-r)}),e.parent.children.forEach((t,n)=>{"Fuc"!==t.data.monosaccharide&&t.data.name!==e.parent.data.name&&t.each(e=>{e.x=e.x-i})})}})}(v=A(v),a),"right-to-left"==a.orientation)?0!=(h=v.x-u/2)&&(d<10?d3.select("#glycang").attr("transform","translate("+(m+s.left-50*d)+","+(s.top-h)+")"):d3.select("#glycang").attr("transform","translate("+s.left+","+(s.top-h)+")")):0!=(h=v.x-m/2)&&d3.select("#glycang").attr("transform","translate("+(s.left-h)+","+s.top+")");var N=v.descendants().slice(1);y.selectAll(".glyd3link").data(N).enter().append("path").attr("d",(function(e){return"M"+b.x(e)+","+b.y(e)+"L"+b.x(e.parent)+","+b.y(e.parent)})).attr("stroke-width",2).attr("stroke","black");var w=y.selectAll(".node").data(v.descendants()).enter().append("g").attr("transform",(function(e){return function(e,t,n){if(0===e.depth)return"translate("+t.x(e)+","+t.y(e)+")";if("right-to-left"===n.orientation)return"translate("+t.x(e)+","+t.y(e)+")";return"fucoriginal"===n.fuctype||"Fuc"!==e.data.monosaccharide?"translate("+t.x(e)+","+t.y(e)+")":(e.y=e.y+4,e.x<e.parent.x?"translate("+t.x(e)+","+t.y(e)+") rotate(-30)":"translate("+t.x(e)+","+t.y(e)+") rotate(30)")}(e,b,a)}));let I=w.append("use").attr("xlink:href",(function(e,t){return function(e,t,a){if("gp"===a&&0===t)return;if(null!=e.data.monosaccharide)var i=e.data.monosaccharide;else i=e.data.name;return""!=i?`${n.monosSVG}#${i.toLowerCase()}`:n.monosSVG+"#unknown"}(e,t,"glycan")})).attr("x",-a.symbsize/2).attr("y",-a.symbsize/2).attr("height",a.symbsize).attr("width",a.symbsize).attr("class","symbol");!0===a.editingMode&&I.on("click",(function(e){var t=v.path(e),n=Array.from(document.querySelectorAll("#modelist input")),a=n.length&&n.find(e=>e.checked).value;"add"===a?x(t,!!r.multimode):"replace"===a?G(t,!!r.multimode):"delete"===a&&k(t)})).on("mouseover",(function(e){d3.select(this.parentElement).append("circle").attr("class","highlightnode").attr("r",a.symbsize/2+10).attr("fill",(function(e){var t=Array.from(document.querySelectorAll("#modelist input")),n=t.length&&t.find(e=>e.checked).value;return"add"===n?(d3.select(this.parentElement).selectAll(".symbol").classed("addcursor",!0).classed("replacecursor",!1).classed("deletecursor",!1),"#227093"):"replace"===n?(d3.select(this.parentElement).selectAll(".symbol").classed("replacecursor",!0).classed("addcursor",!1).classed("deletecursor",!1),"#FFBA3B"):"delete"===n?(d3.select(this.parentElement).selectAll(".symbol").classed("deletecursor",!0).classed("addcursor",!1).classed("replacecursor",!1),"#7D1515"):void 0})).attr("fill-opacity",.4).lower(),$(document).bind("keyup",t=>{"Delete"!=t.originalEvent.key&&"d"!=t.originalEvent.key||$.when($(document).unbind("keyup")).then(t=>{k(v.path(e))})})})).on("mouseout",(function(e){$(document).unbind("keyup"),d3.selectAll(".highlightnode").remove()})),!0===a.linkageVisible&&w.append("text").attr("transform",(function(e,t){return function(e,t,n){if(t>0){var a=180*Math.atan2(e.y-e.parent.y,e.parent.x-e.x)/Math.PI;if("right-to-left"===n.orientation){var i;if(i=n.linkAbbr?2:4,"Fuc"===e.data.monosaccharide&&"fucoriginal"!=n.fuctype)return a<=45?(a=90,`translate(${(e.y-e.parent.y)/2+n.linkFontSize/2},${(e.parent.x-e.x)/2}) rotate(${a})`):(a=-90,`translate(${(e.y-e.parent.y)/2-n.linkFontSize/2},${(e.parent.x-e.x)/2}) rotate(${a})`);if(0==n.linkRotate)switch(!0){case e.x<e.parent.x:return`translate(${(e.y-e.parent.y)/2+n.linkFontSize},${(e.parent.x-e.x)/2-n.linkFontSize})`;case e.x===e.parent.x:return`translate(${(e.y-e.parent.y)/2},${(e.parent.x-e.x)/2-n.linkFontSize/2})`;case e.x>e.parent.x:return`translate(${(e.y-e.parent.y)/2+n.linkFontSize},${(e.parent.x-e.x)/2+n.linkFontSize})`}return a=180*Math.atan2(e.parent.x-e.x,e.y-e.parent.y)/Math.PI,`translate(${(e.y-e.parent.y)/2},${(e.parent.x-e.x)/2-n.linkFontSize/2}) rotate(${a})`}if("Fuc"===e.data.monosaccharide&&"fucoriginal"!=n.fuctype&&e.depth>0&&(a=e.x<e.parent.x?30:150),"Fuc"===e.data.monosaccharide&&"fucoriginal"!=n.fuctype)return a<=45?"translate("+(e.parent.x-e.x-10)/2+","+(e.y-e.parent.y+25)/2+") rotate("+a+")":(a=-30,"translate("+(e.parent.x-e.x+10)/2+","+(e.y-e.parent.y+30)/2+") rotate("+a+")");if(0==n.linkRotate)switch(i=n.linkAbbr?2:4,!0){case e.x<e.parent.x:return"translate("+(e.parent.x-e.x-6*n.linkFontSize+n.linkFontSize*i)/(n.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")";case e.x===e.parent.x:return"translate("+(e.parent.x-e.x+6*n.linkFontSize+n.linkFontSize*i)/(n.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")";case e.x>e.parent.x:return"translate("+(e.parent.x-e.x+6*n.linkFontSize-n.linkFontSize*i)/(n.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")"}return"translate("+(e.parent.x+10-e.x)/2+","+(e.y-e.parent.y)/2+") rotate("+a+")"}return`translate(${n.symbsize/4},${n.symbsize})`}(e,t,a)})).text((function(e,t){return function(e,t,n){var a=e.data.linkage;if(""==a)return;if(0==t)return a=a.replace("a","α").replace("b","β");let i=n.linkAbbr;if("bottom-to-top"===n.orientation&&"Fuc"===e.data.monosaccharide&&e.x>e.parent.x)return 1==i&&(a=a.replace(/[\d\?]\-/g,"")),a=(a=a.split("").reverse().join("")).replace(/a/gi,"α").replace(/b/gi,"β");if(1==i)return a=a.replace(/a(?=[\d\?]?\-[\d\?])/g,"α").replace(/b(?=[\d\?]?\-[\d\?])/,"β").replace(/[\d\?]\-/g,"");return a.search(/[a,b,\?][\d,\?]\-[\d,\?]/)>-1?(a.search(/a[\d,\?]\-[\d,\?]/)>-1?a=a.replace(/a(?=[\d\?]\-[\d\?])/,"α"):a.search(/b[\d\?]\-[\d\?]/)>-1&&(a=a.replace(/b(?=[\d\?]\-[\d\?])/,"β")),a.substr(a.indexOf("-")-2)):a.search(/[a,b,\?]\-/)>-1?a.substr(a.indexOf("-")-1):a.search(/[a,b,\?][\d,\?]/)>-1?"a"===a.charAt(a.length-2)?"α"+a.charAt(a.length-1):"b"===a.charAt(a.length-2)?"β"+a.charAt(a.length-1):a:"a"===a?"α":"b"===a?"β":a}(e,t,a)})).attr("font-size",a.linkFontSize).attr("text-anchor","middle").style("font-family","Arial,Sans");let M=w.append("text").text((function(e){return function(e){if(null==e.data.substituent){t="";return}var t=e.data.substituent;return t=t.replace(/\[(?=[0-9a-zA-Z])/g,"").replace(/\](?=[0-9a-zA-Z])/g,",").replace("]","")}(e)})).attr("font-size",a.linkFontSize).style("font-family","Arial,Sans");"bottom-to-top"===a.orientation?M.attr("x",-a.linkFontSize-3).attr("y",3).attr("text-anchor","end"):M.attr("x",3).attr("y",a.linkFontSize+a.symbsize/2).attr("text-anchor","middle")}function I(e,t){const n=d3.select("#"+t).append("div").attr("class","monodiv").append("div").attr("id",t+"btn"+e.id).attr("class","monobtndiv").attr("title",e.id+" OR "+e.fullname).attr("data-abbr",e.id).on("mouseup",(function(){f(this.dataset.abbr)})).append("svg").attr("id","mono"+e.id).attr("viewBox",e.viewBox).attr("xmlns","http://www.w3.org/2000/svg").attr("width","55").attr("height","35");n.append("g").attr("transform","scale(0.5 0.5) translate(25,0)").html(e.innerhtml);n.append("g").attr("transform","translate(50%,50)").append("text").text(e.id).attr("text-anchor","middle").attr("x","50%").attr("y","90%").attr("font-size","1em")}function M(e){$("#"+t.glytoucanTableDiv).html('\n    <table class="table table-sm">\n      <thead>\n        <tr>\n          <th class="">Reducing End Type:</th>\n          <th class="alpha" scope="col">&alpha;</th>\n          <th class="beta" scope="col">&beta;</th>\n          <th class="unknown" scope="col">Unknown (?)</th>\n          <th class="open"  scope="col">Open</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>GlyTouCan ID:</th>\n          <td class="alpha" id="alphagtcid"></td>\n          <td class="beta" id="betagtcid"></td>\n          <td class="unknown" id="unknowngtcid"></td>\n          <td class="open" id="opengtcid"></td>\n        </tr>\n        <tr>\n          <td>Details:</th>\n          <td class="alpha" id="alphadetails"></td>\n          <td class="beta" id="betadetails"></td>\n          <td class="unknown" id="unknowndetails"></td>\n          <td class="open" id="opendetails"></td>\n      </tr>\n      </tbody>\n    </table>\n    '),e.forEach(e=>{"Error in Structure"==e.glytoucan.response?$(`#${e.name}gtcid`).html("Error in Structure"):"Not Available"==e.glytoucan.response||""==e.glytoucan.id?$(`#${e.name}gtcid`).html("Not Available"):"Error Connecting"==e.glytoucan.response?$(`#${e.name}gtcid`).html("Error Connecting"):($(`#${e.name}gtcid`).html(`${e.glytoucan.id} \n      <button id="copyGlycoCTBtn" class="btn btn-sm btn-link copybtn" onclick="glycoglyph.copyTextFromElement('${e.name}gtcid')" title="Copy">\n        <img src="${n.images}copy.svg" alt="copy" width="20px">\n      </button>\n      `),$(`#${e.name}details`).append(`\n      <a href="https://glytoucan.org/Structures/Glycans/${e.glytoucan.id}" target="_blank"\n      title="View in GlyTouCan">\n      <span class="glytoucan-logo detail-icon"></span></a>`),e.glygenData.glygen.url&&($(`#${e.name}details`).append(`\n          <a href="${e.glygenData.glygen.url}" target="_blank"\n          title="View in GlyGen">\n          <span class="glygen-logo detail-icon"></span></a>\n          `),e.glygenData.pubchem&&$(`#${e.name}details`).append(` \n            <a href="${e.glygenData.pubchem.url}" target="_blank"\n            title="View in PubChem">\n            <span class="pubchem-logo detail-icon"></span></a>`),e.glygenData.chebi&&$(`#${e.name}details`).append(` \n            <a href="${e.glygenData.chebi.url}" target="_blank"\n            title="View in ChEBI">\n            <span class="chebi-logo detail-icon"></span></a>`))),e.primary&&d3.selectAll("."+e.name).classed("table-success",!0)})}async function S(e){return await fetch(e).then(e=>e.json()).then(e=>void 0===e.id?{id:e.id,response:"Error in Structure"}:"no accnumber"===e.id||""===e.id?{id:e.id,response:"Not Available"}:{id:e.id,response:"Success"}).catch(e=>(console.error(e),{id:void 0,response:"Error Connecting"}))}async function E(e){if(""===e)return console.log("GlyTouCan ID is missing"),{glygen:{url:void 0,response:"Not Available"}};return fetch(`https://api.glygen.org/glycan/detail/${e}/`).then(e=>e.json()).then(t=>{let n={};if(n.glygen={url:"https://www.glygen.org/glycan/"+e,response:"Success"},t.crossref){let e=t.crossref.find(e=>"PubChem Compound"===e.database);e&&(n.pubchem={url:e.url,response:"Success"});let a=t.crossref.find(e=>"ChEBI"===e.database);a&&(n.chebi={url:a.url,response:"Success"})}return n}).catch(e=>(console.error(e),e.responseJSON.error_list.some(e=>"non-existent-record"===e.error_code)?(console.log("GlyTouCan ID does not exist in glygen"),{glygen:{url:void 0,response:"Not Available"}}):e.responseJSON.error_list.some(e=>"missing-parameter"===e.error_code)?(console.log("GlyTouCan ID is missing"),{glygen:{url:void 0,response:"Not Available"}}):(console.log("Failed to connect to GlyGen"),{glygen:{url:void 0,response:"Error in connection"}})))}async function D(e){let t,n=[{anomer:"a",name:"alpha"},{anomer:"b",name:"beta"},{anomer:"?",name:"unknown"},{anomer:"",name:"open"}],a=JSON.parse(g(e));a=function e(t){return""!=t.monosaccharide?t:e(t.children[0])}(a),""!==a.monosaccharide&&(t=a.anomer);for(let e=0;e<n.length;e++){a.anomer=n[e].anomer;let i=A(JSON.stringify(a)),r="https://api.glycosmos.org/glycanformatconverter/2.3.2-snapshot/glycoct2wurcs/";r+=encodeURI(i),n[e].primary=n[e].anomer==t,n[e].glytoucan=await S(r),"Success"==n[e].glytoucan.response&&(n[e].glygenData=await E(n[e].glytoucan.id))}return n}e.tracknum=-1,e.trackname=[];var T=79.9568,F=79.9663,H=18.010565,C=42.010565,O=58.005479,L=14.01565,P=-.984016,z={"Neu5,9Ac2":351.308,"4eLeg":250.116486,"6dAlt":164.068473,"6dAltNAc":205.095023,"6dGul":164.068473,"6dTal":164.068473,"6dTalNAc":205.095023,Abe:148.073559,Aci:250.116486,All:180.063388,AllA:194.042653,AllN:179.079373,AllNAc:221.089937,Alt:180.063388,AltA:194.042653,AltN:179.079373,AltNAc:221.089937,Api:150.052823,Ara:150.052823,Bac:162.100442,Col:148.073559,DDmanHep:210.073953,Dha:222.037567,Dig:148.073559,Fru:180.063388,Fuc:164.068473,FucNAc:205.095023,Gal:180.063388,GalA:194.042653,GalN:179.079373,GalNAc:221.089937,Glc:180.063388,GlcA:194.042653,GlcN:179.079373,GlcNAc:221.089937,Gul:180.063388,GulA:194.042653,GulN:179.079373,GulNAc:221.089937,Ido:180.063388,IdoA:194.042653,IdoN:179.079373,IdoNAc:221.089937,Kdn:268.079432,Kdo:238.068867,Leg:250.116486,LDmanHep:210.073953,Lyx:150.052823,Man:180.063388,ManA:194.042653,ManN:179.079373,ManNAc:221.089937,Mur:251.100502,MurNAc:293.111067,MurNGc:309.105981,Neu:267.095417,Neu5Ac:309.105981,Neu5Gc:325.100896,Oli:148.073559,Par:148.073559,Pse:250.116486,Psi:180.063388,Qui:164.068473,QuiNAc:205.095023,Rha:164.068473,RhaNAc:205.095023,Rib:150.052823,Sor:180.063388,Tag:180.063388,Tal:180.063388,TalA:194.042653,TalN:179.079373,TalNAc:221.089937,Tyv:148.073559,Xyl:150.052823};function B(e){let t=d3.hierarchy(JSON.parse(g(e))).descendants(),n={monoisotopicMass:0,monosaccharideCount:0,monosaccharideNotIdentified:0,substituentNotIdentified:0};return t.forEach(e=>{void 0!==z[e.data.monosaccharide]?(n.monoisotopicMass=X(n.monoisotopicMass+z[e.data.monosaccharide]-H),""!==e.data.substituent&&e.data.substituent.replace(/\[/g,"").split("]").forEach(e=>{""!=e&&(e.indexOf("Ac")>-1?n.monoisotopicMass=n.monoisotopicMass+C:e.indexOf("S")>-1?n.monoisotopicMass=n.monoisotopicMass+T:e.indexOf("P")>-1?n.monoisotopicMass=n.monoisotopicMass+F:e.indexOf("Gc")>-1?n.monoisotopicMass=n.monoisotopicMass+O:e.indexOf("Me")>-1?n.monoisotopicMass=n.monoisotopicMass+L:e.indexOf("N")>-1?n.monoisotopicMass=n.monoisotopicMass+P:n.substituentNotIdentified++,n.monoisotopicMass=X(n.monoisotopicMass))}),n.monosaccharideCount++):n.monosaccharideNotIdentified++}),n.monoisotopicMass=X(n.monoisotopicMass+H),n}function X(e){let t=e.toString().split(".")[0].length+6;return+Number.parseFloat(e).toPrecision(t)}e.addLinkage=function(){var e=Array.from(document.querySelectorAll("#orientlist input")),n=e.length&&e.find(e=>e.checked).value,i=Array.from(document.querySelectorAll("#anoposlist input")),r=i.length&&i.find(e=>e.checked).value,o=Array.from(document.querySelectorAll("#acclist input")),c=o.length&&o.find(e=>e.checked).value;a.child.linknum="?"==c?0:+c;var l=n+r+"-"+c;$("#"+t.preparedLinkageSpan).empty().append(l),a.child.linkage=l,h()},e.addSub=function(){var e=Array.from(document.querySelectorAll("#subposlist input")),n=e.length&&e.find(e=>e.checked).value,i=Array.from(document.querySelectorAll("#subtypelist input")),r=i.length&&i.find(e=>e.checked).value;"other"===r&&(r=document.getElementById("substituentother").value);var o="["+(n+r)+"]";$("#"+t.preparedSubstituentSpan).append(o),a.child.substituent=a.child.substituent+o,h()},e.addTerminaltoChild=function(e){let t=d[e].sequence;a.child=JSON.parse(g(t)),$("#monocheck").html(t),$("#linkagecheck").html("<i>Add Linkage</i>")},e.addfirstmono=function(){let e=a.child;if(""===e.linkage){let t=prompt('You have not added any linkage for the first monosaccharide.\n    \nThis will be treated as an open ring. If this is what you desire leave the field below blank and press OK.\n    \nTo indicate a closed ring please type in the linkage information: \n    \nFor example:\n    \n"??" if linkage position is unknown in both anomeric configuratio and position or \n    \n"?1" where 1 indicates the position number and can be replaced with the position you desire.  or\n    \n"b1" where b indicates the anomeric configuration and 1 indicates the position.\n    ',"");e.linkage=null==t||""==t?"":t}else e.linkage=e.linkage.split(/\-/g)[0];e.name=e.substituent+e.monosaccharide+e.linkage,N(e),i.multimode||m()},e.addmono=x,e.appendTerminals=function(){d.forEach((e,t)=>{$("#terminalslist").append(`\n    <li class="template">\n    <button class="btn btn-outline-primary btn-sm"\n      onclick="glycoglyph.addTerminaltoChild(${t})">${e.name}</button>\n    </li>\n  `)})},e.calcMassParams=B,e.cfgToGlycoCT=b,e.childglycan=a,e.clearSub=function(){$("#"+t.preparedSubstituentSpan).empty(),a.child.substituent="",h()},e.cleardrawingarea=function(){document.getElementById(t.nameInputID).value="",document.getElementById(t.glycoCTID).innerHTML="",v(""),d3.select(`#${i.drawdivID}sub`).remove()},e.commonMonos=c,e.copyTextFromElement=function(e){let t=document.getElementById(e),n=t.innerText;var a;"INPUT"==t.tagName&&(n=t.value),n=n.trim(),""!=n?(a=n,navigator.clipboard.writeText(a),alert("Copied: \n"+n)):alert("Nothing to copy.")},e.d3glycanstructure=w,e.domElements=t,e.drawGTCIDTable=M,e.drawingSettings=i,e.dynamicDrawingSettings=r,e.filePaths=n,e.gctMonoList=s,e.gctSubList={NAcetyl:{glycoct:"n-acetyl"},Amino:{glycoct:"amino"},NGlycolyl:{glycoct:"n-glycolyl"},Methyl:{glycoct:"methyl"},Acetyl:{glycoct:"acetyl"},Sulfate:{glycoct:"sulfate"},Phosphate:{glycoct:"phosphate"},Bromo:{glycoct:"bromo"},Chloro:{glycoct:"chloro"},Ethyl:{glycoct:"ethyl"},Ethanolamine:{glycoct:"ethanolamine"},Fluoro:{glycoct:"fluoro"},Formyl:{glycoct:"formyl"},Hydroxymethyl:{glycoct:"hydroxymethyl"},Imino:{glycoct:"imino"},RLactate1:{glycoct:"(r)-lactate"},SLactate1:{glycoct:"(s)-lactate"},NAlanine:{glycoct:"n-alanine"},NFormyl:{glycoct:"n-formyl"},NMethyl:{glycoct:"n-methyl"},NSuccinate:{glycoct:"n-succinate"},NSulfate:{glycoct:"n-sulfate"},NTrifluoroacetyl:{glycoct:"n-trifluoroacetyl"},Nitrate:{glycoct:"nitrate"},Pyruvate:{glycoct:"pyruvate"},Thio:{glycoct:"thio"},RPyruvate:{glycoct:"(r)-pyruvate"},SPyruvate:{glycoct:"(s)-pyruvate"},RLactate2:{glycoct:"(r)-lactate2"},SLactate2:{glycoct:"(s)-lactate2"},Unknown:{glycoct:"unknown"}},e.generateGTCIDTable=async function(){if(!$("#"+t.glytoucanTableDiv))return void console.error("Glytoucan Table Div not found or no name input. Check your code.");if($("#"+t.glytoucanTableDiv).html("\n      Searching...\n    "),""==$("#"+t.nameInputID)[0].value)return void $("#"+t.glytoucanTableDiv).html("\n      No structure created. Draw a structure or enter a name and then try again.\n    ");let e=document.getElementById(t.nameInputID).value;M(await D(e))},e.getGTCID=D,e.glycantojson=g,e.jsonToGlycoCT=A,e.listMonosaccharides=async function(){var e=await d3.xml(n.monosSVG).then((function(e){return[].map.call(e.querySelectorAll("symbol"),(function(e){return{id:e.getAttribute("data-abbr"),viewBox:e.getAttribute("viewBox"),innerhtml:e.innerHTML.replace(/\n|\t/g,"").trim(),fullname:e.getAttribute("data-shortname")}}))}));e.forEach(e=>{I(e,t.fullMonoList)}),c.forEach(n=>{I(e.find(e=>e.id==n),t.commonMonoList)})},e.makechildglycanname=h,e.monos=o,e.monosDict=[{abbreviation:"Glc",configuration:"d",ring:"p"},{abbreviation:"Man",configuration:"d",ring:"p"},{abbreviation:"Gal",configuration:"d",ring:"p"},{abbreviation:"Gul",configuration:"d",ring:"p"},{abbreviation:"Alt",configuration:"l",ring:"p"},{abbreviation:"All",configuration:"d",ring:"p"},{abbreviation:"Tal",configuration:"d",ring:"p"},{abbreviation:"Ido",configuration:"d",ring:"p"},{abbreviation:"GlcNAc",configuration:"d",ring:"p"},{abbreviation:"ManNAc",configuration:"d",ring:"p"},{abbreviation:"GalNAc",configuration:"d",ring:"p"},{abbreviation:"GulNAc",configuration:"d",ring:"p"},{abbreviation:"AltNAc",configuration:"d",ring:"p"},{abbreviation:"AllNAc",configuration:"d",ring:"p"},{abbreviation:"TalNAc",configuration:"d",ring:"p"},{abbreviation:"IdoNAc",configuration:"d",ring:"p"},{abbreviation:"GlcN",configuration:"d",ring:"p"},{abbreviation:"ManN",configuration:"d",ring:"p"},{abbreviation:"GalN",configuration:"d",ring:"p"},{abbreviation:"GulN",configuration:"d",ring:"p"},{abbreviation:"AltN",configuration:"d",ring:"p"},{abbreviation:"AllN",configuration:"d",ring:"p"},{abbreviation:"TalN",configuration:"d",ring:"p"},{abbreviation:"IdoN",configuration:"d",ring:"p"},{abbreviation:"GlcA",configuration:"d",ring:"p"},{abbreviation:"ManA",configuration:"d",ring:"p"},{abbreviation:"GalA",configuration:"d",ring:"p"},{abbreviation:"GulA",configuration:"d",ring:"p"},{abbreviation:"AltA",configuration:"d",ring:"p"},{abbreviation:"AllA",configuration:"d",ring:"p"},{abbreviation:"TalA",configuration:"d",ring:"p"},{abbreviation:"IdoA",configuration:"d",ring:"p"},{abbreviation:"Qui",configuration:"d",ring:"p"},{abbreviation:"Rha",configuration:"d",ring:"p"},{abbreviation:"6dGul",configuration:"d",ring:"p"},{abbreviation:"6dAlt",configuration:"d",ring:"p"},{abbreviation:"6dTal",configuration:"d",ring:"p"},{abbreviation:"Fuc",configuration:"d",ring:"p"},{abbreviation:"QuiNAc",configuration:"d",ring:"p"},{abbreviation:"RhaNAc",configuration:"d",ring:"p"},{abbreviation:"6dAltNAc",configuration:"d",ring:"p"},{abbreviation:"6dTalNAc",configuration:"d",ring:"p"},{abbreviation:"FucNAc",configuration:"d",ring:"p"},{abbreviation:"Oli",configuration:"d",ring:"p"},{abbreviation:"Tyv",configuration:"d",ring:"p"},{abbreviation:"Abe",configuration:"d",ring:"p"},{abbreviation:"Par",configuration:"d",ring:"p"},{abbreviation:"Dig",configuration:"d",ring:"p"},{abbreviation:"Col",configuration:"d",ring:"p"},{abbreviation:"Ara",configuration:"d",ring:"p"},{abbreviation:"Lyx",configuration:"d",ring:"p"},{abbreviation:"Xyl",configuration:"d",ring:"p"},{abbreviation:"Rib",configuration:"d",ring:"p"},{abbreviation:"Kdn",configuration:"d",ring:"p"},{abbreviation:"Neu5Ac",configuration:"d",ring:"p"},{abbreviation:"Neu5Gc",configuration:"d",ring:"p"},{abbreviation:"Neu",configuration:"d",ring:"p"},{abbreviation:"Sia",configuration:"d",ring:"p"},{abbreviation:"Pse",configuration:"d",ring:"p"},{abbreviation:"Leg",configuration:"d",ring:"p"},{abbreviation:"Aci",configuration:"d",ring:"p"},{abbreviation:"4eLeg",configuration:"d",ring:"p"},{abbreviation:"Bac",configuration:"d",ring:"p"},{abbreviation:"LDmanHep",configuration:"d",ring:"p"},{abbreviation:"Kdo",configuration:"d",ring:"p"},{abbreviation:"Dha",configuration:"d",ring:"p"},{abbreviation:"DDmanHep",configuration:"d",ring:"p"},{abbreviation:"MurNAc",configuration:"d",ring:"p"},{abbreviation:"MurNGc",configuration:"d",ring:"p"},{abbreviation:"Mur",configuration:"d",ring:"p"},{abbreviation:"Api",configuration:"d",ring:"p"},{abbreviation:"Fru",configuration:"d",ring:"p"},{abbreviation:"Tag",configuration:"d",ring:"p"},{abbreviation:"Sor",configuration:"d",ring:"p"},{abbreviation:"Psi",configuration:"d",ring:"p"},{abbreviation:"Hex",configuration:"d",ring:"p"},{abbreviation:"HexN",configuration:"d",ring:"p"},{abbreviation:"HexNAc",configuration:"d",ring:"p"},{abbreviation:"HexA",configuration:"d",ring:"p"}],e.monoselect=f,e.objecttoname=y,e.outputParams=function(){var e=document.getElementById(t.nameInputID).value;let n=document.getElementById(t.parametersdiv);if(""!==e){let t=B(e),a=`Monoisotopic Mass: \n    <a href="#" onclick="glycoglyph.copyTextFromElement('calculatedMonoisotopicMass')" title="Click to Copy">\n    <span id="calculatedMonoisotopicMass">${t.monoisotopicMass}</span>\n    </a> <br>\n    Monosaccharide Count: ${t.monosaccharideCount}`;t.monosaccharideNotIdentified>0&&(a+=`<br><span class="text-danger">Unidentified Monosaccharide: ${t.monosaccharideNotIdentified}</span>`),t.substituentNotIdentified>0&&(a+=`<br><span class="text-danger">Unidentified Substituents: ${t.substituentNotIdentified}</span>`),n.innerHTML=a}else n.innerHTML="Draw structure first."},e.outputname=N,e.redo=function(){if(e.tracknum++,e.tracknum!=e.trackname.length){var n=document.getElementById(t.nameInputID);null!=e.trackname[e.tracknum]&&(n.value=e.trackname[e.tracknum],""!=n.value?(w(n.value),b()):($("#"+i.drawdivID).empty(),document.getElementById(t.glycoCTID).innerHTML="")),e.tracknum===e.trackname.length-1&&$("#"+t.redodiv).addClass("hide").removeClass("show"),e.tracknum<e.trackname.length&&$("#"+t.undodiv).removeClass("hide").addClass("show")}},e.replacemono=G,e.resetchildglycan=m,e.savesvg=async function(e){await async function(e){(await d3.text(n.css).then((function(e){return e}))).replace(/\/\*.*\n*\*\//g,"").replace(/\r?\n|\r/g,"").split("}").forEach((function(t){if(""!=t.trim()){var n=t.split("{"),a=n[0].trim();n[1].split(";").forEach((function(t){if(""!=t.trim()){var n=t.split(":"),i=n[0].trim(),r=n[1].trim();"font-weight"==i?d3.select("#"+e).selectAll(a).each((function(e,t){this.getAttribute(i)||this.style[i]===r||d3.select(this).style(i+"",r+"")})):d3.select("#"+e).selectAll(a).each((function(e,t){this.getAttribute(i)||this.style[i]||d3.select(this).style(i+"",r+"")}))}}))}}))}(e),await async function(e){var t=await d3.xml(n.monosSVG).then((function(e){return[].map.call(e.querySelectorAll("symbol"),(function(e){return{id:e.getAttribute("data-abbr"),viewBox:e.getAttribute("viewBox"),innerhtml:e.innerHTML.replace(/\n|\t/g,"").trim(),fullname:e.getAttribute("data-shortname")}}))}));$(`#${e} use`).each((function(e){var n=this.getAttribute("href");if(null!==n){var a=n.split("#")[1],i=this.getAttribute("x"),r=this.getAttribute("y"),o=this.getAttribute("height"),c=this.getAttribute("width"),l=t.find(e=>e.id.toLowerCase()==a),d='<svg id="'+a+'" x="'+i+'" y="'+r+'" height="'+o+'" width="'+c+'" viewBox="'+l.viewBox+'">';d+=l.innerhtml,d+="</svg>",$(this).parent().prepend(d)}})).remove()}(e);var a=document.getElementById(e);a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),a=document.getElementById(e).outerHTML;var i=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download="Figure.svg",document.body.appendChild(o),o.click(),document.body.removeChild(o),w(document.getElementById(t.nameInputID).value)},e.setCSSPath=async function(e,t){n.css=u(e,t)},e.setImagesPath=async function(e,t){n.images=u(e,t)},e.setMonosSVGPath=async function(e,t){n.monosSVG=u(e,t)},e.sortchildren=p,e.starttemplate=function(e){var n=document.getElementById(t.nameInputID);if(""==n.value||confirm("This will clear current Name field. Are you sure you would like to continue?")){n.value="";var a=l.filter(t=>t.name==e&&"starter"===t.type);n.value=a[0].structure,v(n.value),w(n.value),b()}},e.templates=l,e.terminals=d,e.tracknames=v,e.undo=function(){if(0!=e.tracknum){var n=document.getElementById(t.nameInputID);e.tracknum--,null!=e.trackname[e.tracknum]&&(n.value=e.trackname[e.tracknum],""!=n.value?(w(n.value),b()):($("#"+i.drawdivID).empty(),document.getElementById(t.glycoCTID).innerHTML="")),0===e.tracknum&&$("#"+t.undodiv).addClass("hide").removeClass("show"),e.tracknum<e.trackname.length&&$("#"+t.redodiv).removeClass("hide").addClass("show")}},e.version="v2.1.0",Object.defineProperty(e,"__esModule",{value:!0})}));
