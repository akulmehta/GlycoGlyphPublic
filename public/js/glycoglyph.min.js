//  v2.1.8 Copyright 2021 Akul Mehta
!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?a(exports):"function"==typeof define&&define.amd?define(["exports"],a):a((e="undefined"!=typeof globalThis?globalThis:e||self).glycoglyph={})}(this,(function(e){"use strict";let a=[{abbreviation:"4eLeg",configuration:"dd",ring:"p",mass:250.116486},{abbreviation:"6dAlt",configuration:"l",ring:"p",mass:164.068473},{abbreviation:"6dAltNAc",configuration:"l",ring:"p",mass:205.095023},{abbreviation:"6dGul",configuration:"d",ring:"p",mass:164.068473},{abbreviation:"6dTal",configuration:"d",ring:"p",mass:164.068473},{abbreviation:"6dTalNAc",configuration:"d",ring:"p",mass:205.095023},{abbreviation:"Abe",configuration:"d",ring:"p",mass:148.073559},{abbreviation:"Aci",configuration:"ll",ring:"p",mass:250.116486},{abbreviation:"All",configuration:"d",ring:"p",mass:180.063388,glycam:"DAllp"},{abbreviation:"AllA",configuration:"d",ring:"p",mass:194.042653},{abbreviation:"AllN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"AllNAc",configuration:"d",ring:"p",mass:221.089937},{abbreviation:"Alt",configuration:"l",ring:"p",mass:180.063388,glycam:"DAltp"},{abbreviation:"AltA",configuration:"l",ring:"p",mass:194.042653},{abbreviation:"AltN",configuration:"l",ring:"p",mass:179.079373},{abbreviation:"AltNAc",configuration:"l",ring:"p",mass:221.089937},{abbreviation:"Api",configuration:"l",ring:"f",mass:150.052823},{abbreviation:"Ara",configuration:"l",ring:"p",mass:150.052823,glycam:"DArap"},{abbreviation:"Bac",configuration:"d",ring:"p",mass:162.100442},{abbreviation:"Col",configuration:"l",ring:"p",mass:148.073559},{abbreviation:"DDmanHep",configuration:"dd",ring:"p",mass:210.073953},{abbreviation:"Dha",configuration:"d",ring:"p",mass:222.037567},{abbreviation:"Dig",configuration:"d",ring:"p",mass:148.073559},{abbreviation:"Fru",configuration:"d",ring:"p",mass:180.063388,glycam:"DFrup"},{abbreviation:"Fuc",configuration:"l",ring:"p",mass:164.068473,glycam:"LFucp"},{abbreviation:"FucNAc",configuration:"l",ring:"p",mass:205.095023},{abbreviation:"Gal",configuration:"d",ring:"p",mass:180.063388,glycam:"DGalp"},{abbreviation:"GalA",configuration:"d",ring:"p",mass:194.042653,glycam:"DGalpA"},{abbreviation:"GalN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"GalNAc",configuration:"d",ring:"p",mass:221.089937,glycam:"DGalpNAc"},{abbreviation:"Glc",configuration:"d",ring:"p",mass:180.063388,glycam:"DGlcp"},{abbreviation:"GlcA",configuration:"d",ring:"p",mass:194.042653,glycam:"DGlcpA"},{abbreviation:"GlcN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"GlcNAc",configuration:"d",ring:"p",mass:221.089937,glycam:"DGlcpNAc"},{abbreviation:"Gul",configuration:"d",ring:"p",mass:180.063388,glycam:"DGulp"},{abbreviation:"GulA",configuration:"d",ring:"p",mass:194.042653},{abbreviation:"GulN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"GulNAc",configuration:"d",ring:"p",mass:221.089937},{abbreviation:"Hex",configuration:"d",ring:"p"},{abbreviation:"HexA",configuration:"d",ring:"p"},{abbreviation:"HexN",configuration:"d",ring:"p"},{abbreviation:"HexNAc",configuration:"d",ring:"p"},{abbreviation:"Ido",configuration:"l",ring:"p",mass:180.063388},{abbreviation:"IdoA",configuration:"l",ring:"p",mass:194.042653,glycam:"LIdopA"},{abbreviation:"IdoN",configuration:"l",ring:"p",mass:179.079373},{abbreviation:"IdoNAc",configuration:"l",ring:"p",mass:221.089937},{abbreviation:"Kdn",configuration:"dd",ring:"p",mass:268.079432},{abbreviation:"Kdo",configuration:"d",ring:"p",mass:238.068867},{abbreviation:"LDmanHep",configuration:"ld",ring:"p",mass:210.073953},{abbreviation:"Leg",configuration:"dd",ring:"p",mass:250.116486},{abbreviation:"Lyx",configuration:"d",ring:"p",mass:150.052823,glycam:"DLyxp"},{abbreviation:"Man",configuration:"d",ring:"p",mass:180.063388,glycam:"DManp"},{abbreviation:"ManA",configuration:"d",ring:"p",mass:194.042653},{abbreviation:"ManN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"ManNAc",configuration:"d",ring:"p",mass:221.089937,glycam:"DManpNAc"},{abbreviation:"Mur",configuration:"d",ring:"p",mass:251.100502},{abbreviation:"MurNAc",configuration:"d",ring:"p",mass:293.111067},{abbreviation:"MurNGc",configuration:"d",ring:"p",mass:309.105981},{abbreviation:"Neu",configuration:"dd",ring:"p",mass:267.095417},{abbreviation:"Neu5Ac",configuration:"dd",ring:"p",mass:309.105981,glycam:"DNeup5Ac"},{abbreviation:"Neu5Gc",configuration:"dd",ring:"p",mass:325.100896,glycam:"DNeup5Gca"},{abbreviation:"Oli",configuration:"d",ring:"p",mass:148.073559},{abbreviation:"Par",configuration:"d",ring:"p",mass:148.073559},{abbreviation:"Pse",configuration:"ll",ring:"p",mass:250.116486},{abbreviation:"Psi",configuration:"d",ring:"p",mass:180.063388,glycam:"DPsip"},{abbreviation:"Qui",configuration:"d",ring:"p",mass:164.068473,glycam:"DQuip"},{abbreviation:"QuiNAc",configuration:"d",ring:"p",mass:205.095023},{abbreviation:"Rha",configuration:"l",ring:"p",mass:164.068473,glycam:"LRhap"},{abbreviation:"RhaNAc",configuration:"l",ring:"p",mass:205.095023},{abbreviation:"Rib",configuration:"d",ring:"p",mass:150.052823,glycam:"DRibp"},{abbreviation:"Sia",configuration:"dd",ring:"p"},{abbreviation:"Sor",configuration:"l",ring:"p",mass:180.063388,glycam:"LSorp"},{abbreviation:"Tag",configuration:"d",ring:"p",mass:180.063388,glycam:"DTagp"},{abbreviation:"Tal",configuration:"d",ring:"p",mass:180.063388,glycam:"DTalp"},{abbreviation:"TalA",configuration:"d",ring:"p",mass:194.042653},{abbreviation:"TalN",configuration:"d",ring:"p",mass:179.079373},{abbreviation:"TalNAc",configuration:"d",ring:"p",mass:221.089937},{abbreviation:"Tyv",configuration:"d",ring:"p",mass:148.073559},{abbreviation:"Xyl",configuration:"d",ring:"p",mass:150.052823,glycam:"DXylp"}];var t={nameInputID:"cfg_name",glycoCTID:"glycoCT",preparedSubstituentSpan:"subscheck",preparedMonosaccharideSpan:"monocheck",preparedLinkageSpan:"linkagecheck",undodiv:"undodiv",redodiv:"redodiv",multimode:"multimode",glytoucanTableDiv:"gtcid",commonMonoList:"commonmonolist",fullMonoList:"fullmonolist",parametersdiv:"calculated_parametersdiv"},n={monosSVG:`${window.location.protocol}//${window.location.host}/assets/images/monos.svg`,css:`${window.location.protocol}//${window.location.host}/css/glycoglyph.css`,images:`${window.location.protocol}//${window.location.host}/assets/images/`},i={child:{name:"",linkage:"",monosaccharide:"",linknum:0,substituent:"",children:[]}};let r={width:320,height:465,editingMode:!0,orientation:"bottom-to-top",drawdivID:"d3glycanstruc",symbsize:25,drawingareachoice:"fixglycansize",fucopt:"fucdown",linkageVisible:!0,linkRotate:!0,linkAbbr:!1,linkFontSize:12,margin:{top:40,right:40,bottom:40,left:40},drawingSettingsDivID:"glycoglyphDrawingSettings",userOverrideOptions:!0};var o={multimode:!1},c=["Glc","Man","Gal","Gul","Alt","All","Tal","Ido","GlcNAc","ManNAc","GalNAc","GulNAc","AltNAc","AllNAc","TalNAc","IdoNAc","GlcN","ManN","GalN","GulN","AltN","AllN","TalN","IdoN","GlcA","ManA","GalA","GulA","AltA","AllA","TalA","IdoA","Qui","Rha","6dGul","6dAlt","6dTal","Fuc","QuiNAc","RhaNAc","6dAltNAc","6dTalNAc","FucNAc","Oli","Tyv","Abe","Par","Dig","Col","Ara","Lyx","Xyl","Rib","Kdn","Neu5Ac","Neu5Gc","Neu","Sia","Pse","Leg","Aci","4eLeg","Bac","LDmanHep","Kdo","Dha","DDmanHep","MurNAc","MurNGc","Mur","Api","Fru","Tag","Sor","Psi","Hex","HexN","HexNAc","HexA"],l=["Glc","Man","Gal","GlcNAc","GalNAc","Fuc","Neu5Ac","Neu5Gc","Neu","Xyl","IdoA","GlcA","Unknown"],s=[{name:"Chitobiose-core",structure:"GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core",structure:"Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-fuc",structure:"Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-bis",structure:"Mana1-6(GlcNAcb1-4)(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-bis-fuc",structure:"Mana1-6(GlcNAcb1-4)(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-hyb",structure:"Mana1-6(Mana1-3)Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"N-core-hyb-fuc",structure:"Mana1-6(Mana1-3)Mana1-6(Mana1-3)Manb1-4GlcNAcb1-4(Fuca1-6)GlcNAcb1",type:"starter",subtype:"N"},{name:"N-oligoman",structure:"Mana1-2Mana1-6(Mana1-2Mana1-3)Mana1-6(Mana1-2Mana1-2Mana1-3)Manb1-4GlcNAcb1-4GlcNAcb1",type:"starter",subtype:"N"},{name:"Core-1",structure:"Galb1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-2",structure:"GlcNAcb1-6(Galb1-3)GalNAca1",type:"starter",subtype:"O"},{name:"Core-3",structure:"GlcNAcb1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-4",structure:"GlcNAcb1-6(GlcNAcb1-3)GalNAca1",type:"starter",subtype:"O"},{name:"Core-5",structure:"GalNAca1-3GalNAca1",type:"starter",subtype:"O"},{name:"Core-6",structure:"GlcNAcb1-6GalNAca1",type:"starter",subtype:"O"},{name:"Core-7",structure:"GalNAca1-6GalNAca1",type:"starter",subtype:"O"},{name:"Core-8",structure:"Gala1-3GalNAca1",type:"starter",subtype:"O"}],d=[{name:"Blood Group A",sequence:"GalNAca1-3(Fuca1-2)Gal",type:"antigen"},{name:"Blood Group B",sequence:"Gala1-3(Fuca1-2)Gal",type:"antigen"},{name:"Blood Group H",sequence:"Fuca1-2Gal",type:"antigen"},{name:"CAD Antigen",sequence:"Neu5Aca2-6(GalNAcb1-4(Neu5Aca2-3)Galb1-3)GalNAc",type:"antigen"},{name:"Forsmann Antigen",sequence:"GalNAca1-3GalNAcb1-3Gal",type:"antigen"},{name:"Galili Antigen",sequence:"Gala1-3Galb1-4GlcNAc",type:"antigen"},{name:"P antigen",sequence:"GalNAcb1-3Gala1-4Galb1-4Glc",type:"antigen"},{name:"Pk antigen",sequence:"Gala1-4Galb1-4Glc",type:"antigen"},{name:"SDA Antigen",sequence:"GalNAcb1-4(Neu5Aca2-3)Galb1-4GlcNAcb1-3Gal",type:"antigen"},{name:"High Mannose Terminals",sequence:"Mana1-2Man",type:"mannose"},{name:"LacDiNAc",sequence:"GalNAcb1-4GlcNAc",type:"lactosamine"},{name:"Lactosamine",sequence:"Galb1-4GlcNAc",type:"lactosamine"},{name:"Neo-Lactosamine",sequence:"Galb1-3GlcNAc",type:"lactosamine"},{name:"Poly-Lactosamine",sequence:"Galb1-4GlcNAcb1-3Galb1-4GlcNAc",type:"lactosamine"},{name:"Lewis A",sequence:"Galb1-3(Fuca1-4)GlcNAc",type:"lewis"},{name:"Lewis B",sequence:"Fuca1-2Galb1-3(Fuca1-4)GlcNAc",type:"lewis"},{name:"Lewis C",sequence:"Galb1-3GlcNAc",type:"lewis"},{name:"Lewis D",sequence:"Fuca1-2Galb1-3GlcNAc",type:"lewis"},{name:"Lewis X",sequence:"Galb1-4(Fuca1-3)GlcNAc",type:"lewis"},{name:"Lewis Y",sequence:"Fuca1-2Galb1-4(Fuca1-3)GlcNAc",type:"lewis"}],u={Hex:{glycoct:"HEX",transform:"",configdefault:""},Glc:{glycoct:"glc-HEX",transform:"",configdefault:"d"},Man:{glycoct:"man-HEX",transform:"",configdefault:"d"},Gal:{glycoct:"gal-HEX",transform:"",configdefault:"d"},Gul:{glycoct:"gul-HEX",transform:"",configdefault:"d"},Alt:{glycoct:"alt-HEX",transform:"",configdefault:"l"},All:{glycoct:"all-HEX",transform:"",configdefault:"d"},Tal:{glycoct:"tal-HEX",transform:"",configdefault:"d"},Ara:{glycoct:"ara-PEN",transform:"",configdefault:"l"},Lyx:{glycoct:"lyx-PEN",transform:"",configdefault:"d"},Rib:{glycoct:"rib-PEN",transform:"",configdefault:"d"},Bac:{glycoct:"glc-HEX",transform:"|2:d|4:d|6:d",configdefault:"d"},Fuc:{glycoct:"gal-HEX",transform:"-1:5|6:d",configdefault:"l"},HexA:{glycoct:"HEX",transform:"|6:a",configdefault:""},GlcA:{glycoct:"glc-HEX",transform:"-1:5|6:a",configdefault:"d"},ManA:{glycoct:"man-HEX",transform:"-1:5|6:a",configdefault:"d"},GalA:{glycoct:"gal-HEX",transform:"-1:5|6:a",configdefault:"d"},GulA:{glycoct:"gul-HEX",transform:"-1:5|6:a",configdefault:"d"},AltA:{glycoct:"alt-HEX",transform:"-1:5|6:a",configdefault:"l"},AllA:{glycoct:"all-HEX",transform:"-1:5|6:a",configdefault:"d"},TalA:{glycoct:"tal-HEX",transform:"-1:5|6:a",configdefault:"d"},Qui:{glycoct:"glc-HEX",transform:"-1:5|6:d",configdefault:"d"},dHex:{glycoct:"HEX",transform:"|6:d",configdefault:""},Ido:{glycoct:"ido-HEX",transform:"",configdefault:"l"},IdoA:{glycoct:"ido-HEX",transform:"-1:5|6:a",configdefault:"l"},Pen:{glycoct:"PEN-1:4",transform:"",configdefault:""},Rha:{glycoct:"man-HEX",transform:"-1:5|6:d",configdefault:"l"},"6dAlt":{glycoct:"alt-HEX",transform:"-1:5|6:d",configdefault:"l"},"6dTal":{glycoct:"tal-HEX",transform:"-1:5|6:d",configdefault:"d"},"6dGul":{glycoct:"gul-HEX",transform:"-1:5|6:d",configdefault:"d"},Xyl:{glycoct:"xyl-PEN",transform:"",configdefault:"d"},ddHex:{glycoct:"HEX",transform:"|2:d|6:d",configdefault:""},Unknown:{glycoct:"unknown",transform:"",configdefault:""},Oli:{glycoct:"PEN",transform:"|3:d|6:d",configdefault:""},Tyv:{glycoct:"ara-HEX",transform:"|3:d|6:d",configdefault:""},Abe:{glycoct:"dxyl-HEX",transform:"|3:d|6:d",configdefault:""},Par:{glycoct:"rib-HEX",transform:"|3:d|6:d",configdefault:""},Col:{glycoct:"lxyl-HEX",transform:"|3:d|6:d",configdefault:""},Dig:{glycoct:"rib-HEX",transform:"|2:d|6:d",configdefault:"d"},Nonu:{glycoct:"NON",transform:"",configdefault:""},Kdn:{glycoct:"gro-dgal-NON-2:6",transform:"|1:a|2:keto|3:d",configdefault:"d"},Kdo:{glycoct:"man-OCT-2:6",transform:"|1:a|2:keto|3:d",configdefault:"d"},Fru:{glycoct:"ara-HEX-2:5",transform:"|2:keto",configdefault:"d"},Assigned:{glycoct:"assigned-PEN",transform:"",configdefault:""},LDManHep:{glycoct:"ldmanhep-HEX",transform:"",configdefault:""},DDManHep:{glycoct:"ddmanhep-HEX",transform:"",configdefault:""},Dha:{glycoct:"dha-HEX",transform:"",configdefault:""},Mur:{glycoct:"mur-HEX",transform:"",configdefault:""},Sia:{glycoct:"sia-NON",transform:"",configdefault:""},Api:{glycoct:"api-PEN",transform:"",configdefault:"l"},Tag:{glycoct:"tag-PEN",transform:"",configdefault:"d"},Sor:{glycoct:"sor-PEN",transform:"",configdefault:"l"},Psi:{glycoct:"psi-PEN",transform:"",configdefault:"d"}};function g(e,a){return a&&"absolute"!==a?"relative"===a?e:void 0:`${window.location.protocol}//${window.location.host}${e}`}function m(e){(e=(e=(e=(e=e.replace(/ /g,"")).replace(/\((?=\d[a-zA-Z]\))/g,"[")).replace(/(\[\d[a-zA-Z])\)/g,"$1]")).replace(/\u03B1(?=(\d|\?)\-)/g,"a").replace(/\u03B2(?=(\d|\?)\-)/g,"b")).indexOf("GlcN(Gc)")>-1&&(e=e.replace(/GlcN\(Gc\)/,"GlcNGc")),e.indexOf("GalN(Gc)")>-1&&(e=e.replace(/GalN\(Gc\)/,"GalNGc")),e.indexOf("ManN(Gc)")>-1&&(e=e.replace(/ManN\(Gc\)/,"ManNGc"));var a=function(e){var a=e.split(/(\)|\(|-[\d,\?]|-(?=[a-zA-z]))/g).filter((function(e){return""!==e})),t=[];for(let e=0;e<a.length-1;e++)a[e+1].search(/\-[\d,\?]/)>-1?t.push(a[e]+a[e+1]):a[e].search(/\-/)<0&&t.push(a[e]);return t.push(a[a.length-1]),t}(e);function t(e,a,t,n){let i=e.lastIndexOf("(");if("("===a)e.push(a);else if(")"===a)e.splice(i,1);else if("-"!==a){var r,o,l,s,d=a.substring(a.lastIndexOf("]")+1,a.length);d!=a&&(l=a.replace(d,""));for(let e=0;e<d.length;e++)if(!0===c.includes(d.substring(0,d.length-e))){s=+(r=d.substring(d.length-e,d.length)).substr(-1),o=d.substring(0,d.length-e);break}a.search(/Neu5\,9Ac2?/g)>-1&&(o="Neu5Ac",l="[9Ac]",s=+(r=a.replace(/Neu5\,9Ac2?/g,"")).substr(-1)),a.search(/(GlcNGc)|(GalNGc)|(ManNGc)/g)>-1&&(o=o.replace(/Gc/g,""),l="[2Gc]",s=+(r=a.replace(/(GlcNGc)|(GalNGc)|(ManNGc)/g,"")).substr(-1)),null==r&&(r=""),null==o&&(o=""),null==l&&(l=""),null==s&&(s=0);var u=r.charAt(0);/^\d+$/.test(u)&&(u="?"),/\-$/.test(r)&&(r=r.replace(/\-$/,"")),e.push({name:a,linkage:r,monosaccharide:o,substituent:l,linknum:s,anomer:u,uniqueNodeID:t,children:e.splice(i+1,e.length-i-1).reverse()})}return e}return JSON.stringify(a.reduce(t,[])[0],0,2)}function p(e,a=!1){return e.children&&e.data.children.length>0&&(a?e.children.sort((function(e,a){return d3.descending(e.data.linknum,a.data.linknum)})):e.children.sort((function(e,a){return d3.ascending(e.data.linknum,a.data.linknum)})),e.children.findIndex(e=>"Fuc"==e.data.monosaccharide)>-1&&e.depth<=1&&"GlcNAc"===e.data.monosaccharide&&e.children.findIndex(e=>"GlcNAc"==e.data.monosaccharide)>-1&&e.children.sort((e,a)=>"Fuc"==e.data.monosaccharide?-1:"Fuc"==a.data.monosaccharide?1:0),e.children.forEach(e=>{p(e,a)})),e}function f(){i.child={name:"",linkage:"",monosaccharide:"",linknum:0,substituent:"",children:[]},$("#"+t.preparedSubstituentSpan).empty(),$("#"+t.preparedMonosaccharideSpan).empty(),$("#"+t.preparedLinkageSpan).empty()}function h(e){if("Unknown"===e){var a=prompt("Please enter name for the node","");if(null==a)return void alert("Error: Name for the node was blank - did not add the node");e=a}i.child.monosaccharide=e,i.child.children=[],$("#"+t.preparedMonosaccharideSpan).empty().append(e),y()}function y(){i.child.name=i.child.substituent+i.child.monosaccharide+i.child.linkage}function b(e,a){var t="";return""!=e.data.monosaccharide&&""!=e.data.linkage?(void 0!==e.data.substituent&&"[]"!==e.data.substituent||(e.data.substituent=""),e.data.linkage&&-1===e.data.linkage.search("-")&&e.depth>0&&(e.data.linkage=e.data.linkage+"-"),t=e.data.substituent+e.data.monosaccharide+e.data.linkage+t):t=""==e.data.linkage&&null==e.parent?e.data.name+t:e.data.name+"-"+t,a>1&&(t+=")"),e.data.children&&e.data.children.length>0&&e.children.forEach((a,n)=>{t=b(a,e.children.length-n)+t}),a>1&&(t="("+t),t}function A(){var e=document.getElementById(t.nameInputID).value;if(""!==e){var a=N(m(e)).replace(/\n/g,"<br>");document.getElementById(t.glycoCTID).innerHTML=a}else alert("No name typed. Please check Name above.")}function N(e){var a=JSON.parse(e);a=d3.hierarchy(a);var t="RES\n",n=1,i="LIN\n",r=1;return function e(a,o=1){var c=a.data,l=c.monosaccharide,s=n,d=function(e){if(""===a)return[];var a=[];"object"==typeof(a=(a=e.replace(/\[(?=[0-9a-zA-Z])/g,"").replace(/\](?=[0-9a-zA-Z])/g,",").replace("]","")).split(/,/g))&&(a=[a]);return a}(c.substituent).pop(),g="";g=null==c.anomer?"x":""===c.anomer||"-"===c.anomer?"o":"?"==c.anomer?"x":c.anomer;var m="";l.indexOf("NAc")>-1?(m=l.split("NAc")[0],d.unshift("NAc")):l.indexOf("NGc")>-1?(m=l.split("NGc")[0],d.unshift("NGc")):"Neu5Ac"===l?(m="Kdn",d.unshift("5Ac")):"Neu5Gc"===l?(m="Kdn",d.unshift("5Gc")):l.indexOf("N")>-1&&u.hasOwnProperty(l.replace(/N/g,""))?l.search(/(GlcN)|(GalN)|(ManN)/g)>-1&&d.includes("2Gc")?(m=l.replace(/N/g,""),d=d.map(e=>("2Gc"==e&&(e="NGc"),e))):(m=l.replace(/N/g,""),d.unshift("N")):m=l;var p=function(e,a){if("o"===a)return"0:0";var t="Gal,Glc,Man,GalNAc,GlcNAc,ManNAc,Fuc,Neu5Ac,Neu5Gc,Neu,Sia,Xyl,IdoA,GlcA,\n  GalA,GlcA,ManA,GlcN,GalN,ManN,Hex,HexNAc,HexA,HexN,Rha\n  ",n="Rib,Api,Ara";if(t=t.split(/,/g),n=n.split(/,/g),t.includes(e))return"1:5";if(n.includes(e))return"1:4";return"x:x"}(l,g);if(u.hasOwnProperty(m)&&(""==u[m].transform?(t+=n+"b:"+g+"-"+u[m].configdefault+u[m].glycoct+"-"+p+u[m].transform,"o"===g&&(t+="|1:aldi")):"o"==g?(t+=n+"b:"+g+"-"+u[m].configdefault+u[m].glycoct,t+="-0:0"+u[m].transform.replace(/\-\d\:\d/g,"")+"|1:aldi"):t+=n+"b:"+g+"-"+u[m].configdefault+u[m].glycoct+u[m].transform,t+="\n",n++),""!==c.linkage&&"?"!==c.linkage&&1!==s){var f=c.linkage,h=f.charAt(f.length-1),y=f.charAt(f.indexOf("-")-1);"?"===h&&(h="-1"),"?"===y&&(y="1"),i+=`${r}:${o}o(${h}+${y})${s}d\n`,r++}return(d=d.filter(e=>""!==e)).forEach(e=>{var a,o;switch(!0){case"NAc"===e:a=2,o="n-acetyl";break;case"NGc"===e:a=2,o="n-glycolyl";break;case e.indexOf("Ac")>-1:a=e.split(/(?!\d)/g)[0],o="acetyl","Neu5Ac"===l&&5==a&&(o="n-acetyl");break;case e.indexOf("Gc")>-1:a=e.split(/(?!\d)/g)[0],o="glycolyl","Neu5Gc"===l&&(o="n-glycolyl");break;case e.indexOf("Me")>-1:a=e.split(/(?!\d)/g)[0],o="methyl";break;case e.indexOf("N")>-1:a=2,o="amino";break;case e.indexOf("S")>-1:a=e.split(/(?!\d)/g)[0],o="sulfate";break;case e.indexOf("P")>-1:a=e.split(/(?!\d)/g)[0],o="phosphate";break;default:a=e.charAt(0),o=e.split(/(?!\d)/g)[1]}t+=`${n}s:${o}\n`,i+=`${r}:${s}d(${a}+1)${n}n\n`,r++,n++}),a.data.children.length>0&&a.children.forEach(a=>e(a,s)),a}(a),("LIN\n"!==i?t+i:t).trim()}function v(a){e.tracknum>-1&&$("#"+t.undodiv).removeClass("hide").addClass("show"),e.trackname[e.tracknum]!=a&&(e.tracknum++,e.trackname[e.tracknum]=a,e.trackname=e.trackname.filter((a,t)=>t<=e.tracknum),e.tracknum<e.trackname.length&&$("#"+t.redodiv).addClass("hide").removeClass("show"))}function G(e){var a=b(p(d3.hierarchy(e)));v(a),document.getElementById(t.nameInputID).value=a,M(a),A()}function x(e,a){if(""==i.child.monosaccharide)return alert("No monosaccharide selected. \n\nPlease select a monosaccharide to add."),f(),void $("#"+t.multimode).empty();""===i.child.linkage&&(i.child.linkage="??-?");var n=document.getElementById(t.nameInputID).value,r=JSON.parse(m(n)),o=0,c=!1;!function a(t){if(t.name===e[o].data.name)if(o<e.length-1){o++;var n=t.children.findIndex(a=>a.name===e[o].data.name&&a.uniqueNodeID===e[o].data.uniqueNodeID);a(t.children[n])}else t.children.forEach(e=>{e.linknum==i.child.linknum&&(c=!0,alert("You are trying to add a node to a position which is occupied. \nTwo nodes cannot have same linkage acceptor position. \nPlease check the linkages."))}),!1===c&&t.children.push(i.child);return t}(r),G(r),!1===c&&0==a&&f()}function k(e,a){if(1==e.length)return G(i.child),void f();if(""!=i.child.monosaccharide||""!=i.child.linkage||""!=i.child.substituent){var n=document.getElementById(t.nameInputID).value,r=JSON.parse(m(n)),o=0;!function a(t){if(t.name===e[o].data.name)if(o<e.length-2){o++;var n=t.children.findIndex(a=>a.name===e[o].data.name&&a.uniqueNodeID===e[o].data.uniqueNodeID);a(t.children[n])}else{n=t.children.findIndex(a=>a.name===e[o+1].data.name);if(""!=i.child.linkage){var r=t.children.findIndex(e=>e.linknum===i.child.linknum);if(r>-1&&r!=n)return void alert("Two nodes cannot have same linkage position. Please check linkages.");t.children[n].linkage=i.child.linkage,t.children[n].linknum=i.child.linknum}""!=i.child.monosaccharide&&(t.children[n].monosaccharide=i.child.monosaccharide),""!=i.child.substituent?t.children[n].substituent=i.child.substituent:"[]"==i.child.substituent&&(t.children[n].substituent=""),t.children[n].name=t.children[n].substituent+t.children[n].monosaccharide+t.children[n].linkage}return t}(r),G(r),!1===a&&f()}else alert("No replacement criteria selected. Please select what would you like to replace with.")}function w(e){if(1==e.length)return document.getElementById(t.nameInputID).value="",$("#d3glycanstruc").empty(),void $("#glycoCT").html("");var a=document.getElementById(t.nameInputID).value,n=JSON.parse(m(a)),i=0;!function a(t){if(t.name===e[i].data.name)if(i<e.length-2){i++;var n=t.children.findIndex(a=>a.name===e[i].data.name&&a.uniqueNodeID===e[i].data.uniqueNodeID);a(t.children[n])}else{n=t.children.findIndex(a=>a.name===e[i+1].data.name&&a.uniqueNodeID===e[i+1].data.uniqueNodeID);t.children.splice(n,1)}return t}(n),G(n),f()}function M(e,a){let t=JSON.parse(JSON.stringify(r));if(void 0!==a)for(var i in a)void 0!==a[i]&&(t[i]=a[i]);if(!0===t.userOverrideOptions&&(t=function(e){let a=document.querySelector(`#${e.drawingSettingsDivID} form`);if(!a)return console.warn("GlycoGlyph: No settings div found, using default options."),e;return a.querySelectorAll("input, select, checkbox").forEach(a=>{"checkbox"===a.type?e[a.id]=a.checked:"number"===a.type?e[a.id]=+a.value:e[a.id]=a.value}),e}(t)),"right-to-left"===t.orientation){let e=t.width;t.width=t.height,t.height=e}var c=m(e),l=JSON.parse(c),s=function e(a){var t=0;a.children&&a.children.forEach((function(a){var n=e(a);n>t&&(t=n)}));return 1+t}(l),d=t.margin;let u,g;"right-to-left"==t.orientation?u=t.height-d.top-d.bottom:g=t.width-d.left-d.right,"fixdrawingarea"===t.drawingareachoice?"right-to-left"==t.orientation?g=t.width-d.left-d.right:u=t.height-d.top-d.bottom:"fixglycansize"===t.drawingareachoice&&s<=2||"fixglycansize"===t.drawingareachoice&&s<9?"right-to-left"==t.orientation?g=50*s:u=50*s:"fixglycansize"===t.drawingareachoice&&s>=9&&("right-to-left"==t.orientation?g=t.width-d.top-d.bottom:u=t.height-d.top-d.bottom);var f={"right-to-left":{size:[u,g],x:function(e){return g-e.y},y:function(e){return e.x}},"bottom-to-top":{size:[g,u],x:function(e){return e.x},y:function(e){return u-e.y}}};d3.select(`#${t.drawdivID}sub`).remove(),"bottom-to-top"===t.orientation?d3.select("#"+t.drawdivID).style("flex-direction","column-reverse"):d3.select("#"+t.drawdivID).style("flex-direction","row-reverse");d3.select("#"+t.drawdivID).append("div").attr("id",t.drawdivID+"sub");var h,y=d3.select(`#${t.drawdivID}sub`).append("svg").attr("id",t.drawdivID+"SVG").attr("width",g+d.left+d.right).attr("height",u+d.top+d.bottom).append("g").attr("id","glycang").attr("transform","translate("+d.left+","+d.top+")"),b=f[t.orientation],A=d3.tree().size(b.size),N=d3.hierarchy(l);("right-to-left"==t.orientation&&(N=p(N,!0)),function(e,a){if("fucoriginal"===a.fucopt)return;let t=a.width-a.margin.left-a.margin.right;"right-to-left"===a.orientation&&(t=a.height-a.margin.top-a.margin.bottom);var n=e.x;e.each(e=>{if("Fuc"===e.data.monosaccharide){if(0===e.depth)return;e.parent.children[0].x,e.parent.children[e.parent.children.length-1].x,e.parent.children.filter(e=>-1===e.data.name.search("Fuc")).length,e.parent.children.length;e.y=e.parent.y;var i,r=e.parent.x;"fucout"===a.fucopt&&(e.x<n?e.x=e.parent.x-t/5:e.x>n?e.x=e.parent.x+t/5:e.x==n?e.parent.x<n?e.x=e.parent.x-t/5:e.parent.x>n?e.x=e.parent.x+t/5:e.x=e.parent.x-t/5:e.x=e.parent.x-t/5),"fucdown"===a.fucopt&&(e.x<e.parent.x?e.x=e.parent.x-t/5:e.x=e.parent.x+t/5),"fucleft"===a.fucopt&&(e.x=e.parent.x-t/5),e.parent.children.forEach(e=>{"Fuc"!==e.data.monosaccharide&&null==i&&(i=e.x-r)}),e.parent.children.forEach((a,t)=>{"Fuc"!==a.data.monosaccharide&&a.data.name!==e.parent.data.name&&a.each(e=>{e.x=e.x-i})})}})}(N=A(N),t),"right-to-left"==t.orientation)?0!=(h=N.x-u/2)&&(s<10?d3.select("#glycang").attr("transform","translate("+(g+d.left-50*s)+","+(d.top-h)+")"):d3.select("#glycang").attr("transform","translate("+d.left+","+(d.top-h)+")")):0!=(h=N.x-g/2)&&d3.select("#glycang").attr("transform","translate("+(d.left-h)+","+d.top+")");var v=N.descendants().slice(1);y.selectAll(".glyd3link").data(v).enter().append("path").attr("d",(function(e){return"M"+b.x(e)+","+b.y(e)+"L"+b.x(e.parent)+","+b.y(e.parent)})).attr("stroke-width",2).attr("stroke","black");var G=y.selectAll(".node").data(N.descendants()).enter().append("g").attr("transform",(function(e){return function(e,a,t){if(0===e.depth)return"translate("+a.x(e)+","+a.y(e)+")";if("right-to-left"===t.orientation)return"translate("+a.x(e)+","+a.y(e)+")";return"fucoriginal"===t.fuctype||"Fuc"!==e.data.monosaccharide?"translate("+a.x(e)+","+a.y(e)+")":(e.y=e.y+4,e.x<e.parent.x?"translate("+a.x(e)+","+a.y(e)+") rotate(-30)":"translate("+a.x(e)+","+a.y(e)+") rotate(30)")}(e,b,t)}));let M=G.append("use").attr("xlink:href",(function(e,a){return function(e,a,t){if("gp"===t&&0===a)return;if(null!=e.data.monosaccharide)var i=e.data.monosaccharide;else i=e.data.name;return""!=i?`${n.monosSVG}#${i.toLowerCase()}`:n.monosSVG+"#unknown"}(e,a,"glycan")})).attr("x",-t.symbsize/2).attr("y",-t.symbsize/2).attr("height",t.symbsize).attr("width",t.symbsize).attr("class","symbol");!0===t.editingMode&&M.on("click",(function(e){var a=N.path(e),t=Array.from(document.querySelectorAll("#modelist input")),n=t.length&&t.find(e=>e.checked).value;"add"===n?x(a,!!o.multimode):"replace"===n?k(a,!!o.multimode):"delete"===n&&w(a)})).on("mouseover",(function(e){d3.select(this.parentElement).append("circle").attr("class","highlightnode").attr("r",t.symbsize/2+10).attr("fill",(function(e){var a=Array.from(document.querySelectorAll("#modelist input")),t=a.length&&a.find(e=>e.checked).value;return"add"===t?(d3.select(this.parentElement).selectAll(".symbol").classed("addcursor",!0).classed("replacecursor",!1).classed("deletecursor",!1),"#227093"):"replace"===t?(d3.select(this.parentElement).selectAll(".symbol").classed("replacecursor",!0).classed("addcursor",!1).classed("deletecursor",!1),"#FFBA3B"):"delete"===t?(d3.select(this.parentElement).selectAll(".symbol").classed("deletecursor",!0).classed("addcursor",!1).classed("replacecursor",!1),"#7D1515"):void 0})).attr("fill-opacity",.4).lower(),$(document).bind("keyup",a=>{"Delete"!=a.originalEvent.key&&"d"!=a.originalEvent.key||$.when($(document).unbind("keyup")).then(a=>{w(N.path(e))})})})).on("mouseout",(function(e){$(document).unbind("keyup"),d3.selectAll(".highlightnode").remove()})),!0===t.linkageVisible&&G.append("text").attr("transform",(function(e,a){return function(e,a,t){if(a>0){var n=180*Math.atan2(e.y-e.parent.y,e.parent.x-e.x)/Math.PI;if("right-to-left"===t.orientation){var i;if(i=t.linkAbbr?2:4,"Fuc"===e.data.monosaccharide&&"fucoriginal"!=t.fuctype)return n<=45?(n=90,`translate(${(e.y-e.parent.y)/2+t.linkFontSize/2},${(e.parent.x-e.x)/2}) rotate(${n})`):(n=-90,`translate(${(e.y-e.parent.y)/2-t.linkFontSize/2},${(e.parent.x-e.x)/2}) rotate(${n})`);if(0==t.linkRotate)switch(!0){case e.x<e.parent.x:return`translate(${(e.y-e.parent.y)/2+t.linkFontSize},${(e.parent.x-e.x)/2-t.linkFontSize})`;case e.x===e.parent.x:return`translate(${(e.y-e.parent.y)/2},${(e.parent.x-e.x)/2-t.linkFontSize/2})`;case e.x>e.parent.x:return`translate(${(e.y-e.parent.y)/2+t.linkFontSize},${(e.parent.x-e.x)/2+t.linkFontSize})`}return n=180*Math.atan2(e.parent.x-e.x,e.y-e.parent.y)/Math.PI,`translate(${(e.y-e.parent.y)/2},${(e.parent.x-e.x)/2-t.linkFontSize/2}) rotate(${n})`}if("Fuc"===e.data.monosaccharide&&"fucoriginal"!=t.fuctype&&e.depth>0&&(n=e.x<e.parent.x?30:150),"Fuc"===e.data.monosaccharide&&"fucoriginal"!=t.fuctype)return n<=45?"translate("+(e.parent.x-e.x-10)/2+","+(e.y-e.parent.y+t.symbsize-6)/2+") rotate("+n+")":(n=-30,"translate("+(e.parent.x-e.x+10)/2+","+(e.y-e.parent.y+t.symbsize-6)/2+") rotate("+n+")");if(0==t.linkRotate)switch(i=t.linkAbbr?2:4,!0){case e.x<e.parent.x:return"translate("+(e.parent.x-e.x-6*t.linkFontSize+t.linkFontSize*i)/(t.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")";case e.x===e.parent.x:return"translate("+(e.parent.x-e.x+6*t.linkFontSize+t.linkFontSize*i)/(t.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")";case e.x>e.parent.x:return"translate("+(e.parent.x-e.x+6*t.linkFontSize-t.linkFontSize*i)/(t.linkFontSize/2)+","+(e.y-e.parent.y+5)/2+")"}return"translate("+(e.parent.x+10-e.x)/2+","+(e.y-e.parent.y)/2+") rotate("+n+")"}return`translate(${t.symbsize/4},${t.symbsize})`}(e,a,t)})).text((function(e,a){return function(e,a,t){var n=e.data.linkage;if(""==n)return;if(0==a)return n=n.replace("a","α").replace("b","β");let i=t.linkAbbr;if("bottom-to-top"===t.orientation&&"Fuc"===e.data.monosaccharide&&e.x>e.parent.x)return 1==i&&(n=n.replace(/[\d\?]\-/g,"")),n=(n=n.split("").reverse().join("")).replace(/a/gi,"α").replace(/b/gi,"β");if(1==i)return n=n.replace(/a(?=[\d\?]?\-[\d\?])/g,"α").replace(/b(?=[\d\?]?\-[\d\?])/,"β").replace(/[\d\?]\-/g,"");return n.search(/[a,b,\?][\d,\?]\-[\d,\?]/)>-1?(n.search(/a[\d,\?]\-[\d,\?]/)>-1?n=n.replace(/a(?=[\d\?]\-[\d\?])/,"α"):n.search(/b[\d\?]\-[\d\?]/)>-1&&(n=n.replace(/b(?=[\d\?]\-[\d\?])/,"β")),n.substr(n.indexOf("-")-2)):n.search(/[a,b,\?]\-/)>-1?n.substr(n.indexOf("-")-1):n.search(/[a,b,\?][\d,\?]/)>-1?"a"===n.charAt(n.length-2)?"α"+n.charAt(n.length-1):"b"===n.charAt(n.length-2)?"β"+n.charAt(n.length-1):n:"a"===n?"α":"b"===n?"β":n}(e,a,t)})).attr("font-size",t.linkFontSize).attr("text-anchor","middle").style("font-family","Arial,Sans");let I=G.append("text").text((function(e){return function(e){if(null==e.data.substituent){a="";return}var a=e.data.substituent;return a=a.replace(/\[(?=[0-9a-zA-Z])/g,"").replace(/\](?=[0-9a-zA-Z])/g,",").replace("]","")}(e)})).attr("font-size",t.linkFontSize).style("font-family","Arial,Sans");"bottom-to-top"===t.orientation?I.attr("x",-t.linkFontSize-3).attr("y",3).attr("text-anchor","end"):I.attr("x",3).attr("y",t.linkFontSize+t.symbsize/2).attr("text-anchor","middle")}function I(e,a){const t=d3.select("#"+a).append("div").attr("class","monodiv").append("div").attr("id",a+"btn"+e.id).attr("class","monobtndiv").attr("title",e.id+" OR "+e.fullname).attr("data-abbr",e.id).on("mouseup",(function(){h(this.dataset.abbr)})).append("svg").attr("id","mono"+e.id).attr("viewBox",e.viewBox).attr("xmlns","http://www.w3.org/2000/svg").attr("width","55").attr("height","35");t.append("g").attr("transform","scale(0.5 0.5) translate(25,0)").html(e.innerhtml);t.append("g").attr("transform","translate(50%,50)").append("text").text(e.id).attr("text-anchor","middle").attr("x","50%").attr("y","90%").attr("font-size","1em")}function S(e){$("#"+t.glytoucanTableDiv).html('\n    <table class="table table-sm">\n      <thead>\n        <tr>\n          <th class="">Reducing End Type:</th>\n          <th class="alpha" scope="col">&alpha;</th>\n          <th class="beta" scope="col">&beta;</th>\n          <th class="unknown" scope="col">Unknown (?)</th>\n          <th class="open"  scope="col">Open</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td>GlyTouCan ID:</th>\n          <td class="alpha" id="alphagtcid"></td>\n          <td class="beta" id="betagtcid"></td>\n          <td class="unknown" id="unknowngtcid"></td>\n          <td class="open" id="opengtcid"></td>\n        </tr>\n        <tr>\n          <td>Details:</th>\n          <td class="alpha" id="alphadetails"></td>\n          <td class="beta" id="betadetails"></td>\n          <td class="unknown" id="unknowndetails"></td>\n          <td class="open" id="opendetails"></td>\n      </tr>\n      </tbody>\n    </table>\n    '),e.forEach(e=>{"Error in Structure"==e.glytoucan.response?$(`#${e.name}gtcid`).html("Error in Structure"):"Not Available"==e.glytoucan.response||""==e.glytoucan.id?$(`#${e.name}gtcid`).html("Not Available"):"Error Connecting"==e.glytoucan.response?$(`#${e.name}gtcid`).html("Error Connecting"):($(`#${e.name}gtcid`).html(`${e.glytoucan.id} \n      <button id="copyGlycoCTBtn" class="btn btn-sm btn-link copybtn" onclick="glycoglyph.copyTextFromElement('${e.name}gtcid')" title="Copy">\n        <img src="${n.images}copy.svg" alt="copy" width="20px">\n      </button>\n      `),$(`#${e.name}details`).append(`\n      <a href="https://glytoucan.org/Structures/Glycans/${e.glytoucan.id}" target="_blank"\n      title="View in GlyTouCan">\n      <span class="glytoucan-logo detail-icon"></span></a>`),e.glygenData.glygen.url&&($(`#${e.name}details`).append(`\n          <a href="${e.glygenData.glygen.url}" target="_blank"\n          title="View in GlyGen">\n          <span class="glygen-logo detail-icon"></span></a>\n          `),e.glygenData.pubchem&&$(`#${e.name}details`).append(` \n            <a href="${e.glygenData.pubchem.url}" target="_blank"\n            title="View in PubChem">\n            <span class="pubchem-logo detail-icon"></span></a>`),e.glygenData.chebi&&$(`#${e.name}details`).append(` \n            <a href="${e.glygenData.chebi.url}" target="_blank"\n            title="View in ChEBI">\n            <span class="chebi-logo detail-icon"></span></a>`))),e.primary&&d3.selectAll("."+e.name).classed("table-success",!0)})}async function D(e){return await fetch(e).then(e=>e.json()).then(e=>void 0===e.id?{id:e.id,response:"Error in Structure"}:"no accnumber"===e.id||""===e.id?{id:e.id,response:"Not Available"}:{id:e.id,response:"Success"}).catch(e=>(console.error(e),{id:void 0,response:"Error Connecting"}))}async function E(e){if(""===e)return console.log("GlyTouCan ID is missing"),{glygen:{url:void 0,response:"Not Available"}};return fetch(`https://api.glygen.org/glycan/detail/${e}/`).then(e=>e.json()).then(a=>{if(a.error_list&&a.error_list.some(e=>"non-existent-record"===e.error_code))return console.log("GlyTouCan ID does not exist in glygen"),{glygen:{url:void 0,response:"Not Available"}};let t={};if(t.glygen={url:"https://www.glygen.org/glycan/"+e,response:"Success",rawData:a},a.crossref){let e=a.crossref.find(e=>"PubChem Compound"===e.database);e&&(t.pubchem={url:e.url,response:"Success"});let n=a.crossref.find(e=>"ChEBI"===e.database);n&&(t.chebi={url:n.url,response:"Success"})}return a.enzyme&&(t.enzymes=a.enzyme),t}).catch(e=>(console.error(e),e.responseJSON&&e.err.responseJSON.error_list&&e.responseJSON.error_list.some(e=>"non-existent-record"===e.error_code)?(console.log("GlyTouCan ID does not exist in glygen"),{glygen:{url:void 0,response:"Not Available"}}):e.responseJSON&&e.err.responseJSON.error_list&&e.responseJSON.error_list.some(e=>"missing-parameter"===e.error_code)?(console.log("GlyTouCan ID is missing"),{glygen:{url:void 0,response:"Not Available"}}):(console.log("Failed to connect to GlyGen"),{glygen:{url:void 0,response:"Error in connection"}})))}async function T(e,a=!1){let t,n=[{anomer:"a",name:"alpha"},{anomer:"b",name:"beta"},{anomer:"?",name:"unknown"},{anomer:"",name:"open"}],i=JSON.parse(m(e));i=function e(a){return""!=a.monosaccharide?a:e(a.children[0])}(i),""!==i.monosaccharide&&(t=i.anomer);for(let e=0;e<n.length;e++){i.anomer=n[e].anomer;let r=N(JSON.stringify(i)),o="https://api.glycosmos.org/glycanformatconverter/2.5.2/glycoct2wurcs/";o+=encodeURI(r),n[e].primary=n[e].anomer==t,n[e].glytoucan=await D(o),a&&"Success"==n[e].glytoucan.response&&(n[e].glygenData=await E(n[e].glytoucan.id))}return n}e.tracknum=-1,e.trackname=[];var H=79.9568,F=79.9663,C=18.010565,O=42.010565,L=58.005479,P=14.01565,z=-.984016,B={"Neu5,9Ac2":351.308,"4eLeg":250.116486,"6dAlt":164.068473,"6dAltNAc":205.095023,"6dGul":164.068473,"6dTal":164.068473,"6dTalNAc":205.095023,Abe:148.073559,Aci:250.116486,All:180.063388,AllA:194.042653,AllN:179.079373,AllNAc:221.089937,Alt:180.063388,AltA:194.042653,AltN:179.079373,AltNAc:221.089937,Api:150.052823,Ara:150.052823,Bac:162.100442,Col:148.073559,DDmanHep:210.073953,Dha:222.037567,Dig:148.073559,Fru:180.063388,Fuc:164.068473,FucNAc:205.095023,Gal:180.063388,GalA:194.042653,GalN:179.079373,GalNAc:221.089937,Glc:180.063388,GlcA:194.042653,GlcN:179.079373,GlcNAc:221.089937,Gul:180.063388,GulA:194.042653,GulN:179.079373,GulNAc:221.089937,Ido:180.063388,IdoA:194.042653,IdoN:179.079373,IdoNAc:221.089937,Kdn:268.079432,Kdo:238.068867,Leg:250.116486,LDmanHep:210.073953,Lyx:150.052823,Man:180.063388,ManA:194.042653,ManN:179.079373,ManNAc:221.089937,Mur:251.100502,MurNAc:293.111067,MurNGc:309.105981,Neu:267.095417,Neu5Ac:309.105981,Neu5Gc:325.100896,Oli:148.073559,Par:148.073559,Pse:250.116486,Psi:180.063388,Qui:164.068473,QuiNAc:205.095023,Rha:164.068473,RhaNAc:205.095023,Rib:150.052823,Sor:180.063388,Tag:180.063388,Tal:180.063388,TalA:194.042653,TalN:179.079373,TalNAc:221.089937,Tyv:148.073559,Xyl:150.052823};function X(e){let a=d3.hierarchy(JSON.parse(m(e))).descendants(),t={monoisotopicMass:0,monosaccharideCount:0,monosaccharideNotIdentified:0,substituentNotIdentified:0};return a.forEach(e=>{void 0!==B[e.data.monosaccharide]?(t.monoisotopicMass=q(t.monoisotopicMass+B[e.data.monosaccharide]-C),""!==e.data.substituent&&e.data.substituent.replace(/\[/g,"").split("]").forEach(e=>{""!=e&&(e.indexOf("Ac")>-1?t.monoisotopicMass=t.monoisotopicMass+O:e.indexOf("S")>-1?t.monoisotopicMass=t.monoisotopicMass+H:e.indexOf("P")>-1?t.monoisotopicMass=t.monoisotopicMass+F:e.indexOf("Gc")>-1?t.monoisotopicMass=t.monoisotopicMass+L:e.indexOf("Me")>-1?t.monoisotopicMass=t.monoisotopicMass+P:e.indexOf("N")>-1?t.monoisotopicMass=t.monoisotopicMass+z:t.substituentNotIdentified++,t.monoisotopicMass=q(t.monoisotopicMass))}),t.monosaccharideCount++):t.monosaccharideNotIdentified++}),t.monoisotopicMass=q(t.monoisotopicMass+C),t}function q(e){let a=e.toString().split(".")[0].length+6;return+Number.parseFloat(e).toPrecision(a)}function R(e){let a=e;a=a.replace(/\u2013|\u2014/g,"-"),a=a.replace(/-\d$/g,"");let t=JSON.parse(m(a));t=function e(a){a.linkage.includes("ac")&&(a.linkage=a.linkage.replace(/ac/g,""),a.name=a.name.replace(/ac/g,"Ac"),a.monosaccharide=a.monosaccharide+"Ac");a.children.length>0&&a.children.forEach(a=>{a=e(a)});return a}(t);let n=b(p(d3.hierarchy(t))),i={originalName:e,correctedSequence:n,error:!1};return n!==e&&(i.error=!0),i}function J(e,t){let n={name:"",errors:[]};e.data.monosaccharide||n.errors.push("Undefined monosaccharide in "+e.data.name),""==e.data.linkage&&n.errors.push("Undefined linkage in "+e.data.name),null!=e.data.substituents&&n.errors.push("Substituents present in "+e.data.name);let i=a.find(a=>a.abbreviation===e.data.monosaccharide);return i&&i.glycam?""!=e.data.monosaccharide&&""!=e.data.linkage?(e.data.linkage&&-1===e.data.linkage.search("-")&&e.depth,n.name=i.glycam+e.data.linkage+n.name):""==e.data.linkage&&null==e.parent?(""==e.data.linkage&&n.errors.push(`Reducing end linkage required in ${e.data.name}. For example "GlcNAcb1"`),n.name=i.glycam+n.name):""==e.data.linkage&&null==e.parent.monosaccharide?n.name=i.glycam+n.name:n.errors.push("Undefined Linkage in "+e.data.name):n.errors.push("Not supported by Glycam in "+e.data.name),t>1&&(n.name=n.name+"]"),e.data.children&&e.data.children.length>0&&e.children.forEach((a,t)=>{let i=J(a,e.children.length-t);n.name=i.name+n.name,n.errors=[...n.errors,...i.errors]}),t>1&&(n.name="["+n.name),n}let _={H:"Hex",N:"HexNAc",A:"Neu5Ac",G:"Neu5Gc",F:"Fuc",X:"Xyl",HA:"HexA",HS:"HexN",MN:"MurNAc",KDN:"Kdn",pH:"[P]Hex",aH:"[+17]Hex",PG:"[pr]Gal",sH:"[S]Hex",S:"[5Az]Neu",mH:"[mod]Hex",mN:"[mod]HexNAc"};e.addLinkage=function(){var e=Array.from(document.querySelectorAll("#orientlist input")),a=e.length&&e.find(e=>e.checked).value,n=Array.from(document.querySelectorAll("#anoposlist input")),r=n.length&&n.find(e=>e.checked).value,o=Array.from(document.querySelectorAll("#acclist input")),c=o.length&&o.find(e=>e.checked).value;i.child.linknum="?"==c?0:+c;var l=a+r+"-"+c;$("#"+t.preparedLinkageSpan).empty().append(l),i.child.linkage=l,y()},e.addSub=function(){var e=Array.from(document.querySelectorAll("#subposlist input")),a=e.length&&e.find(e=>e.checked).value,n=Array.from(document.querySelectorAll("#subtypelist input")),r=n.length&&n.find(e=>e.checked).value;"other"===r&&(r=document.getElementById("substituentother").value);var o="["+(a+r)+"]";$("#"+t.preparedSubstituentSpan).append(o),i.child.substituent=i.child.substituent+o,y()},e.addTerminaltoChild=function(e){let a=d[e].sequence;i.child=JSON.parse(m(a)),$("#monocheck").html(a),$("#linkagecheck").html("<i>Add Linkage</i>")},e.addfirstmono=function(){let e=i.child;if(""===e.linkage){let a=prompt('You have not added any linkage for the first monosaccharide.\n    \nThis will be treated as an open ring. If this is what you desire leave the field below blank and press OK.\n    \nTo indicate a closed ring please type in the linkage information: \n    \nFor example:\n    \n"??" if linkage position is unknown in both anomeric configuratio and position or \n    \n"?1" where 1 indicates the position number and can be replaced with the position you desire.  or\n    \n"b1" where b indicates the anomeric configuration and 1 indicates the position.\n    ',"");e.linkage=null==a||""==a?"":a}else e.linkage=e.linkage.split(/\-/g)[0];e.name=e.substituent+e.monosaccharide+e.linkage,G(e),r.multimode||f()},e.addmono=x,e.appendTerminals=function(){d.forEach((e,a)=>{$("#terminalslist").append(`\n    <li class="template">\n    <button class="btn btn-outline-primary btn-sm"\n      onclick="glycoglyph.addTerminaltoChild(${a})">${e.name}</button>\n    </li>\n  `)})},e.autoCheckName=R,e.calcMassParams=X,e.cfgToGlycoCT=A,e.childglycan=i,e.clearSub=function(){$("#"+t.preparedSubstituentSpan).empty(),i.child.substituent="",y()},e.cleardrawingarea=function(){document.getElementById(t.nameInputID).value="",document.getElementById(t.glycoCTID).innerHTML="",v(""),d3.select(`#${r.drawdivID}sub`).remove()},e.commonMonos=l,e.copyTextFromElement=function(e){let a=document.getElementById(e),t=a.innerText;var n;"INPUT"==a.tagName&&(t=a.value),t=t.trim(),""!=t?(n=t,navigator.clipboard.writeText(n),alert("Copied: \n"+t)):alert("Nothing to copy.")},e.d3glycanstructure=M,e.detectPGlyco=function(e){let a=Object.keys(_);return a.push("("),a.push(")"),a=a.map(e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|"),new RegExp(`^((${a})*)$`).test(e)},e.domElements=t,e.drawGTCIDTable=S,e.drawingSettings=r,e.dynamicDrawingSettings=o,e.fetchGlyGenData=E,e.filePaths=n,e.gctMonoList=u,e.gctSubList={NAcetyl:{glycoct:"n-acetyl"},Amino:{glycoct:"amino"},NGlycolyl:{glycoct:"n-glycolyl"},Methyl:{glycoct:"methyl"},Acetyl:{glycoct:"acetyl"},Sulfate:{glycoct:"sulfate"},Phosphate:{glycoct:"phosphate"},Bromo:{glycoct:"bromo"},Chloro:{glycoct:"chloro"},Ethyl:{glycoct:"ethyl"},Ethanolamine:{glycoct:"ethanolamine"},Fluoro:{glycoct:"fluoro"},Formyl:{glycoct:"formyl"},Hydroxymethyl:{glycoct:"hydroxymethyl"},Imino:{glycoct:"imino"},RLactate1:{glycoct:"(r)-lactate"},SLactate1:{glycoct:"(s)-lactate"},NAlanine:{glycoct:"n-alanine"},NFormyl:{glycoct:"n-formyl"},NMethyl:{glycoct:"n-methyl"},NSuccinate:{glycoct:"n-succinate"},NSulfate:{glycoct:"n-sulfate"},NTrifluoroacetyl:{glycoct:"n-trifluoroacetyl"},Nitrate:{glycoct:"nitrate"},Pyruvate:{glycoct:"pyruvate"},Thio:{glycoct:"thio"},RPyruvate:{glycoct:"(r)-pyruvate"},SPyruvate:{glycoct:"(s)-pyruvate"},RLactate2:{glycoct:"(r)-lactate2"},SLactate2:{glycoct:"(s)-lactate2"},Unknown:{glycoct:"unknown"}},e.generateGTCIDTable=async function(){if(!$("#"+t.glytoucanTableDiv))return void console.error("Glytoucan Table Div not found or no name input. Check your code.");if($("#"+t.glytoucanTableDiv).html("\n      Searching...\n    "),""==$("#"+t.nameInputID)[0].value)return void $("#"+t.glytoucanTableDiv).html("\n      No structure created. Draw a structure or enter a name and then try again.\n    ");let e=document.getElementById(t.nameInputID).value;S(await T(e,!0))},e.getGTCID=T,e.glycantojson=m,e.jsonToGlycoCT=N,e.listMonosaccharides=async function(){var e=await d3.xml(n.monosSVG).then((function(e){return[].map.call(e.querySelectorAll("symbol"),(function(e){return{id:e.getAttribute("data-abbr"),viewBox:e.getAttribute("viewBox"),innerhtml:e.innerHTML.replace(/\n|\t/g,"").trim(),fullname:e.getAttribute("data-shortname")}}))}));e.forEach(e=>{I(e,t.fullMonoList)}),l.forEach(a=>{I(e.find(e=>e.id==a),t.commonMonoList)})},e.makechildglycanname=y,e.monos=c,e.monosDict=a,e.monoselect=h,e.objectToGlycam=J,e.objecttoname=b,e.outputParams=function(){var e=document.getElementById(t.nameInputID).value;let a=document.getElementById(t.parametersdiv);if(""!==e){let t=X(e),n=`Monoisotopic Mass: \n    <a href="#" onclick="glycoglyph.copyTextFromElement('calculatedMonoisotopicMass')" title="Click to Copy">\n    <span id="calculatedMonoisotopicMass">${t.monoisotopicMass}</span>\n    </a> <br>\n    Monosaccharide Count: ${t.monosaccharideCount}`;t.monosaccharideNotIdentified>0&&(n+=`<br><span class="text-danger">Unidentified Monosaccharide: ${t.monosaccharideNotIdentified}</span>`),t.substituentNotIdentified>0&&(n+=`<br><span class="text-danger">Unidentified Substituents: ${t.substituentNotIdentified}</span>`),a.innerHTML=n}else a.innerHTML="Draw structure first."},e.outputname=G,e.pGlycoDict=_,e.pGlycoToGlycoGlyph=function(e){let a=e.split(""),t=[],n=[];for(let e=a.length;e>=0;e--)if("("!=a[e]&&")"!=a[e])n.push(a[e]);else{let i=n.reverse().join("");i in _?t.push(_[i]+"??-?"):""!=i&&t.push(i+"??-?"),")"==a[e]?t.push("("):"("==a[e]&&t.push(")"),n=[]}let i=R(t.join("")).correctedSequence;return i.endsWith("-?")&&(i=i.slice(0,-2)),i},e.redo=function(){if(e.tracknum++,e.tracknum!=e.trackname.length){var a=document.getElementById(t.nameInputID);null!=e.trackname[e.tracknum]&&(a.value=e.trackname[e.tracknum],""!=a.value?(M(a.value),A()):($("#"+r.drawdivID).empty(),document.getElementById(t.glycoCTID).innerHTML="")),e.tracknum===e.trackname.length-1&&$("#"+t.redodiv).addClass("hide").removeClass("show"),e.tracknum<e.trackname.length&&$("#"+t.undodiv).removeClass("hide").addClass("show")}},e.replacemono=k,e.resetchildglycan=f,e.savesvg=async function(e){await async function(e){(await d3.text(n.css).then((function(e){return e}))).replace(/\/\*.*\n*\*\//g,"").replace(/\r?\n|\r/g,"").split("}").forEach((function(a){if(""!=a.trim()){var t=a.split("{"),n=t[0].trim();t[1].split(";").forEach((function(a){if(""!=a.trim()){var t=a.split(":"),i=t[0].trim(),r=t[1].trim();"font-weight"==i?d3.select("#"+e).selectAll(n).each((function(e,a){this.getAttribute(i)||this.style[i]===r||d3.select(this).style(i+"",r+"")})):d3.select("#"+e).selectAll(n).each((function(e,a){this.getAttribute(i)||this.style[i]||d3.select(this).style(i+"",r+"")}))}}))}}))}(e),await async function(e){var a=await d3.xml(n.monosSVG).then((function(e){return[].map.call(e.querySelectorAll("symbol"),(function(e){return{id:e.getAttribute("data-abbr"),viewBox:e.getAttribute("viewBox"),innerhtml:e.innerHTML.replace(/\n|\t/g,"").trim(),fullname:e.getAttribute("data-shortname")}}))}));$(`#${e} use`).each((function(e){var t=this.getAttribute("href");if(null!==t){var n=t.split("#")[1],i=this.getAttribute("x"),r=this.getAttribute("y"),o=this.getAttribute("height"),c=this.getAttribute("width"),l=a.find(e=>e.id.toLowerCase()==n),s='<svg id="'+n+'" x="'+i+'" y="'+r+'" height="'+o+'" width="'+c+'" viewBox="'+l.viewBox+'">';s+=l.innerhtml,s+="</svg>",$(this).parent().prepend(s)}})).remove()}(e);var a=document.getElementById(e);a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),a=document.getElementById(e).outerHTML;var i=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download="Figure.svg",document.body.appendChild(o),o.click(),document.body.removeChild(o),M(document.getElementById(t.nameInputID).value)},e.sequenceToGlycam=function(e,{suffix:a="-OH",linkerToReplace:t=""}={}){""!=t&&(e=e.replace(t,""));let n=J(d3.hierarchy(JSON.parse(m(e))));return n.errors=[...new Set(n.errors)],n.name=n.name+a,n},e.setCSSPath=async function(e,a){n.css=g(e,a)},e.setImagesPath=async function(e,a){n.images=g(e,a)},e.setMonosSVGPath=async function(e,a){n.monosSVG=g(e,a)},e.sortchildren=p,e.starttemplate=function(e){var a=document.getElementById(t.nameInputID);if(""==a.value||confirm("This will clear current Name field. Are you sure you would like to continue?")){a.value="";var n=s.filter(a=>a.name==e&&"starter"===a.type);a.value=n[0].structure,v(a.value),M(a.value),A()}},e.templates=s,e.terminals=d,e.tracknames=v,e.undo=function(){if(0!=e.tracknum){var a=document.getElementById(t.nameInputID);e.tracknum--,null!=e.trackname[e.tracknum]&&(a.value=e.trackname[e.tracknum],""!=a.value?(M(a.value),A()):($("#"+r.drawdivID).empty(),document.getElementById(t.glycoCTID).innerHTML="")),0===e.tracknum&&$("#"+t.undodiv).addClass("hide").removeClass("show"),e.tracknum<e.trackname.length&&$("#"+t.redodiv).removeClass("hide").addClass("show")}},e.version="v2.1.8",Object.defineProperty(e,"__esModule",{value:!0})}));
